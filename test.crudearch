CRUDARCHv1{"files": {"main.py": {"type": "py", "content": "ZnJvbSB1aWVkaXRvciBpbXBvcnQgVUlFZGl0b3INCmltcG9ydCB0a2ludGVyIGFzIHRrDQoNCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6DQogICAgcm9vdCA9IHRrLlRrKCkNCiAgICBlZGl0b3IgPSBVSUVkaXRvcihyb290KQ0KICAgIHJvb3QubWFpbmxvb3AoKQ0K"}, "uieditor.py": {"type": "py", "content": "aW1wb3J0IGpzb24NCmltcG9ydCBvcw0KaW1wb3J0IHBsYXRmb3JtDQppbXBvcnQgdGltZQ0KaW1wb3J0IHN1YnByb2Nlc3MNCmltcG9ydCB0cmFjZWJhY2sNCmltcG9ydCB0a2ludGVyIGFzIHRrDQpmcm9tIHRraW50ZXIgaW1wb3J0IHR0aywgbWVzc2FnZWJveCwgZmlsZWRpYWxvZywgY29sb3JjaG9vc2VyDQpmcm9tIHR5cGluZyBpbXBvcnQgT3B0aW9uYWwsIERpY3QsIEFueSwgQ2FsbGFibGUNCmZyb20gcHJvamVjdCBpbXBvcnQgUHJvamVjdA0KZnJvbSB1aWVsZW1lbnRzIGltcG9ydCBVSUVsZW1lbnQsIFBhbmVsLCBCdXR0b24sIExhYmVsLCBUZXh0Qm94LCBDb250YWluZXJFbGVtZW50DQpmcm9tIHNjZW5lIGltcG9ydCBTY2VuZQ0KZnJvbSB0eXBpbmcgaW1wb3J0IE9wdGlvbmFsDQoNCmNsYXNzIEV2ZW50RWRpdG9yOg0KICAgICIiIkN1c3RvbSBldmVudCBlZGl0b3IgaGFuZGxlciB3aXRoIGF1dG9tYXRpYyBlbWJlZGRpbmciIiINCiAgICBkZWYgX19pbml0X18oc2VsZiwgcGFyZW50X2ZyYW1lKToNCiAgICAgICAgc2VsZi5wYXJlbnRfZnJhbWUgPSBwYXJlbnRfZnJhbWUNCiAgICAgICAgc2VsZi5lZGl0b3JfcHJvY2VzcyA9IE5vbmUNCiAgICAgICAgc2VsZi5lZGl0b3JfaHduZCA9IE5vbmUNCiAgICAgICAgc2VsZi5jdXJyZW50X3Byb2plY3QgPSBOb25lDQogICAgICAgIHNlbGYuZW1iZWRfY2FudmFzID0gTm9uZQ0KICAgICAgICBzZWxmLmNvbnNvbGVfbGluZSA9IDANCiAgICAgICAgc2VsZi5lcnJvcl9saW5lID0gMCAgIyBUcmFjayBlcnJvciBtZXNzYWdlIHBvc2l0aW9uDQogICAgICAgIHNlbGYuY3JlYXRlX2VkaXRvcl91aSgpDQogICAgICAgIHNlbGYuZW1iZWRfZWRpdG9yKCkNCiAgICAgICAgDQogICAgZGVmIGNyZWF0ZV9lZGl0b3JfdWkoc2VsZik6DQogICAgICAgICIiIkNyZWF0ZSB0aGUgZWRpdG9yIFVJIGNvbXBvbmVudHMiIiINCiAgICAgICAgc2VsZi5lZGl0b3JfZnJhbWUgPSB0dGsuRnJhbWUoc2VsZi5wYXJlbnRfZnJhbWUpDQogICAgICAgIHNlbGYuZWRpdG9yX2ZyYW1lLnBhY2soZmlsbD10ay5CT1RILCBleHBhbmQ9VHJ1ZSkNCiAgICAgICAgDQogICAgICAgICMgQnV0dG9uIGNvbnRyb2xzIGZyYW1lDQogICAgICAgIHNlbGYuY29udHJvbF9mcmFtZSA9IHR0ay5GcmFtZShzZWxmLmVkaXRvcl9mcmFtZSkNCiAgICAgICAgc2VsZi5jb250cm9sX2ZyYW1lLnBhY2soZmlsbD10ay5YLCBwYWR4PTUsIHBhZHk9NSkNCiAgICAgICAgDQogICAgICAgIHR0ay5CdXR0b24oc2VsZi5jb250cm9sX2ZyYW1lLCANCiAgICAgICAgICAgICAgICAgIHRleHQ9IlJ1biBQcm9qZWN0IiwgDQogICAgICAgICAgICAgICAgICBjb21tYW5kPXNlbGYucnVuX3Byb2plY3QpLnBhY2soc2lkZT10ay5MRUZULCBwYWR4PTIpDQogICAgICAgIHR0ay5CdXR0b24oc2VsZi5jb250cm9sX2ZyYW1lLCANCiAgICAgICAgICAgICAgICAgIHRleHQ9IlJlZnJlc2ggRWRpdG9yIiwgDQogICAgICAgICAgICAgICAgICBjb21tYW5kPXNlbGYucmVmcmVzaF9lZGl0b3IpLnBhY2soc2lkZT10ay5MRUZULCBwYWR4PTIpDQogICAgICAgIA0KICAgICAgICAjIENhbnZhcyBmb3IgZW1iZWRkaW5nIHdpdGggZGFyayBiYWNrZ3JvdW5kDQogICAgICAgIHNlbGYuZW1iZWRfY2FudmFzID0gdGsuQ2FudmFzKA0KICAgICAgICAgICAgc2VsZi5lZGl0b3JfZnJhbWUsIA0KICAgICAgICAgICAgYmc9JyMyZDJkMmQnLCANCiAgICAgICAgICAgIGhpZ2hsaWdodHRoaWNrbmVzcz0wDQogICAgICAgICkNCiAgICAgICAgc2VsZi5lbWJlZF9jYW52YXMucGFjayhmaWxsPXRrLkJPVEgsIGV4cGFuZD1UcnVlKQ0KDQogICAgIyBBZGQgQ29uc29sZSBPdXRwdXQgZnJhbWUgYXQgYm90dG9tDQogICAgICAgIHNlbGYuY29uc29sZV9mcmFtZSA9IHR0ay5MYWJlbEZyYW1lKHNlbGYuZWRpdG9yX2ZyYW1lLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ9IkNvbnNvbGUgT3V0cHV0IiwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ9MTUwKQ0KICAgICAgICBzZWxmLmNvbnNvbGVfZnJhbWUucGFjayhmaWxsPXRrLlgsIHBhZHg9NSwgcGFkeT01KQ0KICAgICAgICBzZWxmLmNvbnNvbGVfZnJhbWUucGFja19wcm9wYWdhdGUoRmFsc2UpICAjIEZpeGVkIGhlaWdodA0KICAgICAgICANCiAgICAgICAgc2VsZi5jb25zb2xlX3RleHQgPSB0ay5UZXh0KA0KICAgICAgICAgICAgc2VsZi5jb25zb2xlX2ZyYW1lLCANCiAgICAgICAgICAgIHdyYXA9dGsuV09SRCwgDQogICAgICAgICAgICBzdGF0ZT0nZGlzYWJsZWQnLA0KICAgICAgICAgICAgYmc9J2JsYWNrJywNCiAgICAgICAgICAgIGZnPSd3aGl0ZScsDQogICAgICAgICAgICBmb250PSgnQ29uc29sYXMnLCA5KQ0KICAgICAgICApDQogICAgICAgIHNlbGYuY29uc29sZV9zY3JvbGwgPSB0dGsuU2Nyb2xsYmFyKHNlbGYuY29uc29sZV9mcmFtZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWVudD10ay5WRVJUSUNBTCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQ9c2VsZi5jb25zb2xlX3RleHQueXZpZXcpDQogICAgICAgIHNlbGYuY29uc29sZV90ZXh0LmNvbmZpZ3VyZSh5c2Nyb2xsY29tbWFuZD1zZWxmLmNvbnNvbGVfc2Nyb2xsLnNldCkNCiAgICAgICAgDQogICAgICAgIHNlbGYuY29uc29sZV9zY3JvbGwucGFjayhzaWRlPXRrLlJJR0hULCBmaWxsPXRrLlkpDQogICAgICAgIHNlbGYuY29uc29sZV90ZXh0LnBhY2soZmlsbD10ay5CT1RILCBleHBhbmQ9VHJ1ZSkNCiAgICANCg0KICAgIGRlZiBkaXNwbGF5X2Vycm9yKHNlbGYsIG1lc3NhZ2UpOg0KICAgICAgICAiIiJEaXNwbGF5IGVycm9yIG9uIGJvdGggY2FudmFzIGFuZCBjb25zb2xlIiIiDQogICAgICAgIHNlbGYuZXJyb3JfbGluZSArPSAxDQogICAgICAgIHlfcG9zaXRpb24gPSAyMCArIChzZWxmLmVycm9yX2xpbmUgKiAyMCkNCiAgICAgICAgDQogICAgICAgICMgQ2FudmFzIGRpc3BsYXkgKGJyaWVmKQ0KICAgICAgICBzZWxmLmVtYmVkX2NhbnZhcy5jcmVhdGVfdGV4dCgNCiAgICAgICAgICAgIDEwLCB5X3Bvc2l0aW9uLA0KICAgICAgICAgICAgdGV4dD1tZXNzYWdlLnNwbGl0KCdcbicpWzBdWzoxMDBdLCAgIyBTaG93IGZpcnN0IGxpbmUgdHJ1bmNhdGVkDQogICAgICAgICAgICBhbmNob3I9dGsuTlcsDQogICAgICAgICAgICBmaWxsPSJ3aGl0ZSIsDQogICAgICAgICAgICBmb250PSgnQ29uc29sYXMnLCAxMCksDQogICAgICAgICAgICB0YWdzPSJlcnJvciINCiAgICAgICAgKQ0KICAgICAgICANCiAgICAgICAgIyBGdWxsIGVycm9yIHRvIGNvbnNvbGUNCiAgICAgICAgc2VsZi5sb2dfdG9fY29uc29sZShmIkVSUk9SOiB7bWVzc2FnZX0iKQ0KICAgICAgICANCiAgICAgICAgaWYgeV9wb3NpdGlvbiA+IHNlbGYuZW1iZWRfY2FudmFzLndpbmZvX2hlaWdodCgpOg0KICAgICAgICAgICAgc2VsZi5lbWJlZF9jYW52YXMueXZpZXdfbW92ZXRvKDEuMCkNCg0KICAgIGRlZiBsb2dfdG9fY29uc29sZShzZWxmLCBtZXNzYWdlKToNCiAgICAgICAgIiIiQWRkIG1lc3NhZ2UgdG8gY29uc29sZSBvdXRwdXQiIiINCiAgICAgICAgc2VsZi5jb25zb2xlX3RleHQuY29uZmlnKHN0YXRlPSdub3JtYWwnKQ0KICAgICAgICBzZWxmLmNvbnNvbGVfbGluZSArPSAxDQogICAgICAgIHNlbGYuY29uc29sZV90ZXh0Lmluc2VydCh0ay5FTkQsIGYie3NlbGYuY29uc29sZV9saW5lfToge21lc3NhZ2V9XG4iKQ0KICAgICAgICBzZWxmLmNvbnNvbGVfdGV4dC5jb25maWcoc3RhdGU9J2Rpc2FibGVkJykNCiAgICAgICAgc2VsZi5jb25zb2xlX3RleHQuc2VlKHRrLkVORCkgICMgQXV0by1zY3JvbGwgdG8gYm90dG9tDQoNCiAgICBkZWYgY2xlYXJfZXJyb3JzKHNlbGYpOg0KICAgICAgICAiIiJDbGVhciBib3RoIGNhbnZhcyBhbmQgY29uc29sZSBlcnJvcnMiIiINCiAgICAgICAgc2VsZi5lbWJlZF9jYW52YXMuZGVsZXRlKCJlcnJvciIpDQogICAgICAgIHNlbGYuZXJyb3JfbGluZSA9IDANCiAgICAgICAgc2VsZi5jb25zb2xlX3RleHQuY29uZmlnKHN0YXRlPSdub3JtYWwnKQ0KICAgICAgICBzZWxmLmNvbnNvbGVfdGV4dC5kZWxldGUoMS4wLCB0ay5FTkQpDQogICAgICAgIHNlbGYuY29uc29sZV90ZXh0LmNvbmZpZyhzdGF0ZT0nZGlzYWJsZWQnKQ0KICAgICAgICBzZWxmLmNvbnNvbGVfbGluZSA9IDANCiAgICANCg0KICAgIGRlZiBnZXRfZWRpdG9yX2V4ZWN1dGFibGUoc2VsZik6DQogICAgICAgICIiIkdldCBwbGF0Zm9ybS1zcGVjaWZpYyBlZGl0b3IgZXhlY3V0YWJsZSB3aXRoIGVycm9yIGhhbmRsaW5nIiIiDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGJhc2VfcGF0aCA9IG9zLnBhdGguam9pbihvcy5wYXRoLmRpcm5hbWUoX19maWxlX18pLCAiZXZlbnRlZGl0b3IiKQ0KICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGJhc2VfcGF0aCk6DQogICAgICAgICAgICAgICAgcmFpc2UgRmlsZU5vdEZvdW5kRXJyb3IoZiJFZGl0b3IgZGlyZWN0b3J5IG5vdCBmb3VuZDoge2Jhc2VfcGF0aH0iKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgc3lzdGVtID0gcGxhdGZvcm0uc3lzdGVtKCkubG93ZXIoKQ0KICAgICAgICAgICAgZXhlY3V0YWJsZXMgPSB7DQogICAgICAgICAgICAgICAgJ3dpbmRvd3MnOiAnY3J1ZGV0ZXh0LmV4ZScsDQogICAgICAgICAgICAgICAgJ2xpbnV4JzogJ2NydWRldGV4dF9saW51eCcsDQogICAgICAgICAgICAgICAgJ2Rhcndpbic6ICdjcnVkZXRleHRfbWFjJw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBleGVfbmFtZSA9IGV4ZWN1dGFibGVzLmdldChzeXN0ZW0pDQogICAgICAgICAgICBwcmludChleGVfbmFtZSkNCiAgICAgICAgICAgIGlmIG5vdCBleGVfbmFtZToNCiAgICAgICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGYiVW5zdXBwb3J0ZWQgcGxhdGZvcm06IHtzeXN0ZW19IikNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIGV4ZV9wYXRoID0gb3MucGF0aC5qb2luKGJhc2VfcGF0aCwgZXhlX25hbWUpDQogICAgICAgICAgICBwcmludChleGVfcGF0aCkNCiAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhleGVfcGF0aCk6DQogICAgICAgICAgICAgICAgcmFpc2UgRmlsZU5vdEZvdW5kRXJyb3IoZiJFZGl0b3IgZXhlY3V0YWJsZSBub3QgZm91bmQ6IHtleGVfcGF0aH0iKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIGV4ZV9wYXRoDQogICAgICAgICAgICANCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgc2VsZi5kaXNwbGF5X2Vycm9yKGYiRXJyb3IgbG9jYXRpbmcgZWRpdG9yIGV4ZWN1dGFibGU6XG57dHJhY2ViYWNrLmZvcm1hdF9leGMoKX0iKQ0KICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgDQogICAgZGVmIGVtYmVkX2VkaXRvcihzZWxmKToNCiAgICAgICAgIiIiRW1iZWQgdGhlIGVkaXRvciB3aXRoIGNvbXByZWhlbnNpdmUgZXJyb3IgaGFuZGxpbmciIiINCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgZWRpdG9yX2V4ZSA9IHNlbGYuZ2V0X2VkaXRvcl9leGVjdXRhYmxlKCkNCiAgICAgICAgICAgIHNlbGYubGF1bmNoX2VkaXRvcl9wcm9jZXNzKGVkaXRvcl9leGUpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdXaW5kb3dzJzoNCiAgICAgICAgICAgICAgICBzZWxmLmVtYmVkX3dpbmRvd3NfZWRpdG9yKCkNCiAgICAgICAgICAgIGVsaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gJ0xpbnV4JzoNCiAgICAgICAgICAgICAgICBzZWxmLmVtYmVkX2xpbnV4X2VkaXRvcigpDQogICAgICAgICAgICBlbGlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdEYXJ3aW4nOg0KICAgICAgICAgICAgICAgIHNlbGYuZW1iZWRfbWFjX2VkaXRvcigpDQogICAgICAgICAgICAgICAgDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgIHNlbGYuZGlzcGxheV9lcnJvcihmIkZhaWxlZCB0byBlbWJlZCBlZGl0b3I6XG57dHJhY2ViYWNrLmZvcm1hdF9leGMoKX0iKQ0KICAgIA0KICAgIGRlZiBsYXVuY2hfZWRpdG9yX3Byb2Nlc3Moc2VsZiwgZWRpdG9yX2V4ZSk6DQogICAgICAgICIiIkxhdW5jaCBlZGl0b3IgcHJvY2VzcyB3aXRoIGVycm9yIGhhbmRsaW5nIiIiDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGNyZWF0aW9uZmxhZ3MgPSAwDQogICAgICAgICAgICBpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnV2luZG93cyc6DQogICAgICAgICAgICAgICAgaW1wb3J0IHdpbjMycHJvY2Vzcw0KICAgICAgICAgICAgICAgIGNyZWF0aW9uZmxhZ3MgPSAoc3VicHJvY2Vzcy5DUkVBVEVfTk9fV0lORE9XIHwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5DUkVBVEVfTkVXX1BST0NFU1NfR1JPVVApDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICBzZWxmLmVkaXRvcl9wcm9jZXNzID0gc3VicHJvY2Vzcy5Qb3BlbigNCiAgICAgICAgICAgICAgICBbZWRpdG9yX2V4ZV0sDQogICAgICAgICAgICAgICAgc3RkaW49c3VicHJvY2Vzcy5QSVBFLA0KICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsDQogICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwNCiAgICAgICAgICAgICAgICBjcmVhdGlvbmZsYWdzPWNyZWF0aW9uZmxhZ3MNCiAgICAgICAgICAgICkNCiAgICAgICAgICAgIA0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICBzZWxmLmRpc3BsYXlfZXJyb3IoZiJGYWlsZWQgdG8gbGF1bmNoIGVkaXRvciBwcm9jZXNzOlxue3RyYWNlYmFjay5mb3JtYXRfZXhjKCl9IikNCiAgICAgICAgICAgIHJhaXNlDQogICAgDQogICAgZGVmIGVtYmVkX3dpbmRvd3NfZWRpdG9yKHNlbGYpOg0KICAgICAgICAiIiJXaW5kb3dzLXNwZWNpZmljIGVtYmVkZGluZyB3aXRoIHJvYnVzdCBlcnJvciBoYW5kbGluZyIiIg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpbXBvcnQgd2luMzJndWkNCiAgICAgICAgICAgIGltcG9ydCB3aW4zMmNvbg0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIFdhaXQgZm9yIGVkaXRvciB3aW5kb3cgd2l0aCB0aW1lb3V0DQogICAgICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkNCiAgICAgICAgICAgIHRpbWVvdXQgPSA1ICAjIHNlY29uZHMNCiAgICAgICAgICAgIHNlbGYuZWRpdG9yX2h3bmQgPSBOb25lDQogICAgICAgICAgICANCiAgICAgICAgICAgIHdoaWxlIHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSA8IHRpbWVvdXQ6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAjIFRyeSB0byBmaW5kIHdpbmRvdyBieSBjbGFzcyBuYW1lIGlmIHRpdGxlIGRvZXNuJ3Qgd29yaw0KICAgICAgICAgICAgICAgICAgICBzZWxmLmVkaXRvcl9od25kID0gd2luMzJndWkuRmluZFdpbmRvdygiQ3J1ZGVUZXh0Q2xhc3MiLCBOb25lKSBvciBcDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbjMyZ3VpLkZpbmRXaW5kb3coTm9uZSwgIkNydWRlVGV4dCIpDQogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuZWRpdG9yX2h3bmQ6DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuMSkNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgbm90IHNlbGYuZWRpdG9yX2h3bmQ6DQogICAgICAgICAgICAgICAgcmFpc2UgUnVudGltZUVycm9yKGYiRWRpdG9yIHdpbmRvdyBub3QgZm91bmQgYWZ0ZXIge3RpbWVvdXR9IHNlY29uZHMiKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIEdldCBjYW52YXMgd2luZG93IElEDQogICAgICAgICAgICBjYW52YXNfaHduZCA9IGludChzZWxmLmVtYmVkX2NhbnZhcy53aW5mb19pZCgpKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIFNldCBwYXJlbnQgYW5kIG1vZGlmeSBzdHlsZXMNCiAgICAgICAgICAgIHdpbjMyZ3VpLlNldFBhcmVudChzZWxmLmVkaXRvcl9od25kLCBjYW52YXNfaHduZCkNCiAgICAgICAgICAgIHN0eWxlID0gKHdpbjMyY29uLldTX1ZJU0lCTEUgfCB3aW4zMmNvbi5XU19DSElMRCB8IA0KICAgICAgICAgICAgICAgICAgICB3aW4zMmNvbi5XU19DTElQQ0hJTERSRU4gfCB3aW4zMmNvbi5XU19DTElQU0lCTElOR1MpDQogICAgICAgICAgICB3aW4zMmd1aS5TZXRXaW5kb3dMb25nKHNlbGYuZWRpdG9yX2h3bmQsIHdpbjMyY29uLkdXTF9TVFlMRSwgc3R5bGUpDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgSW5pdGlhbCByZXNpemUNCiAgICAgICAgICAgIHNlbGYucmVzaXplX2VkaXRvcl90b19jYW52YXMoKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIEJpbmQgcmVzaXplIGhhbmRsZXINCiAgICAgICAgICAgIHNlbGYuZW1iZWRfY2FudmFzLmJpbmQoIjxDb25maWd1cmU+Iiwgc2VsZi5vbl9jYW52YXNfcmVzaXplKQ0KICAgICAgICAgICAgDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgIHNlbGYuZGlzcGxheV9lcnJvcihmIldpbmRvd3MgZW1iZWRkaW5nIGZhaWxlZDpcbnt0cmFjZWJhY2suZm9ybWF0X2V4YygpfSIpDQogICAgICAgICAgICByYWlzZQ0KICAgIA0KICAgIA0KICAgIGRlZiBvbl9jYW52YXNfcmVzaXplKHNlbGYsIGV2ZW50KToNCiAgICAgICAgIiIiSGFuZGxlIGNhbnZhcyByZXNpemUgd2l0aCBlcnJvciBoYW5kbGluZyIiIg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBzZWxmLnJlc2l6ZV9lZGl0b3JfdG9fY2FudmFzKCkNCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgc2VsZi5kaXNwbGF5X2Vycm9yKGYiUmVzaXplIGVycm9yOlxue3RyYWNlYmFjay5mb3JtYXRfZXhjKCl9IikNCiAgICANCiAgICBkZWYgcmVzaXplX2VkaXRvcl90b19jYW52YXMoc2VsZik6DQogICAgICAgICIiIlJlc2l6ZSBlZGl0b3IgdG8gZml0IGNhbnZhcyB3aXRoIGVycm9yIGhhbmRsaW5nIiIiDQogICAgICAgIGlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdXaW5kb3dzJyBhbmQgc2VsZi5lZGl0b3JfaHduZDoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpbXBvcnQgd2luMzJndWkNCiAgICAgICAgICAgICAgICB3aWR0aCA9IG1heCgxMCwgc2VsZi5lbWJlZF9jYW52YXMud2luZm9fd2lkdGgoKSkNCiAgICAgICAgICAgICAgICBoZWlnaHQgPSBtYXgoMTAsIHNlbGYuZW1iZWRfY2FudmFzLndpbmZvX2hlaWdodCgpKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHdpbjMyZ3VpLk1vdmVXaW5kb3coDQogICAgICAgICAgICAgICAgICAgIHNlbGYuZWRpdG9yX2h3bmQsDQogICAgICAgICAgICAgICAgICAgIDAsIDAsDQogICAgICAgICAgICAgICAgICAgIHdpZHRoLCBoZWlnaHQsDQogICAgICAgICAgICAgICAgICAgIFRydWUNCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAgICAgc2VsZi5kaXNwbGF5X2Vycm9yKGYiV2luZG93IHJlc2l6ZSBmYWlsZWQ6XG57dHJhY2ViYWNrLmZvcm1hdF9leGMoKX0iKQ0KICAgICAgICAgICAgICAgIHJhaXNlDQogICAgDQogICAgZGVmIHJ1bl9wcm9qZWN0KHNlbGYpOg0KICAgICAgICAiIiJSdW4gcHJvamVjdCB3aXRoIGNvbXByZWhlbnNpdmUgZXJyb3IgaGFuZGxpbmciIiINCiAgICAgICAgc2VsZi5jbGVhcl9lcnJvcnMoKSAgIyBDbGVhciBwcmV2aW91cyBlcnJvcnMNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBzZWxmLmN1cnJlbnRfcHJvamVjdDoNCiAgICAgICAgICAgIHNlbGYuZGlzcGxheV9lcnJvcigiRXJyb3I6IE5vIHByb2plY3QgbG9hZGVkIikNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmN1cnJlbnRfcHJvamVjdC5tYWluX2ZpbGU6DQogICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiTm8gbWFpbiBmaWxlIHNwZWNpZmllZCBpbiBwcm9qZWN0IikNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIHNjcmlwdF9wYXRoID0gb3MucGF0aC5qb2luKHNlbGYuY3VycmVudF9wcm9qZWN0LnByb2plY3RfZGlyLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmN1cnJlbnRfcHJvamVjdC5tYWluX2ZpbGUpDQogICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoc2NyaXB0X3BhdGgpOg0KICAgICAgICAgICAgICAgIHJhaXNlIEZpbGVOb3RGb3VuZEVycm9yKGYiU2NyaXB0IG5vdCBmb3VuZDoge3NjcmlwdF9wYXRofSIpDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICBweXRob25fZXhlYyA9IHNlbGYuY3VycmVudF9wcm9qZWN0LnB5dGhvbl9wYXRoIG9yICJweXRob24iDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgUnVuIHdpdGggcGxhdGZvcm0tc3BlY2lmaWMgY29tbWFuZHMNCiAgICAgICAgICAgIGlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdXaW5kb3dzJzoNCiAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLlBvcGVuKA0KICAgICAgICAgICAgICAgICAgICBbJ3N0YXJ0JywgJ2NtZCcsICcvaycsIHB5dGhvbl9leGVjLCBzY3JpcHRfcGF0aF0sDQogICAgICAgICAgICAgICAgICAgIHNoZWxsPVRydWUsDQogICAgICAgICAgICAgICAgICAgIGN3ZD1zZWxmLmN1cnJlbnRfcHJvamVjdC5wcm9qZWN0X2Rpcg0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5Qb3BlbigNCiAgICAgICAgICAgICAgICAgICAgW3B5dGhvbl9leGVjLCBzY3JpcHRfcGF0aF0sDQogICAgICAgICAgICAgICAgICAgIGN3ZD1zZWxmLmN1cnJlbnRfcHJvamVjdC5wcm9qZWN0X2Rpcg0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICANCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgc2VsZi5kaXNwbGF5X2Vycm9yKGYiRmFpbGVkIHRvIHJ1biBwcm9qZWN0Olxue3RyYWNlYmFjay5mb3JtYXRfZXhjKCl9IikNCiAgICANCiAgICBkZWYgcmVmcmVzaF9lZGl0b3Ioc2VsZik6DQogICAgICAgICIiIlJlZnJlc2ggZWRpdG9yIHdpdGggZXJyb3IgaGFuZGxpbmciIiINCiAgICAgICAgc2VsZi5jbGVhcl9lcnJvcnMoKQ0KICAgICAgICANCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaWYgc2VsZi5lZGl0b3JfcHJvY2VzczoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdXaW5kb3dzJyBhbmQgc2VsZi5lZGl0b3JfaHduZDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydCB3aW4zMmd1aQ0KICAgICAgICAgICAgICAgICAgICAgICAgd2luMzJndWkuRGVzdHJveVdpbmRvdyhzZWxmLmVkaXRvcl9od25kKQ0KICAgICAgICAgICAgICAgICAgICBzZWxmLmVkaXRvcl9wcm9jZXNzLnRlcm1pbmF0ZSgpDQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBDbGVhciBhbmQgcmUtZW1iZWQNCiAgICAgICAgICAgIHNlbGYuZW1iZWRfY2FudmFzLmRlbGV0ZSgiYWxsIikNCiAgICAgICAgICAgIHNlbGYuZWRpdG9yX2h3bmQgPSBOb25lDQogICAgICAgICAgICBzZWxmLmVkaXRvcl9wcm9jZXNzID0gTm9uZQ0KICAgICAgICAgICAgc2VsZi5lbWJlZF9lZGl0b3IoKQ0KICAgICAgICAgICAgDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgIHNlbGYuZGlzcGxheV9lcnJvcihmIkZhaWxlZCB0byByZWZyZXNoIGVkaXRvcjpcbnt0cmFjZWJhY2suZm9ybWF0X2V4YygpfSIpDQpjbGFzcyBVSUVkaXRvcjoNCiAgICAiIiJNYWluIGVkaXRvciBhcHBsaWNhdGlvbiIiIg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCByb290OiB0ay5Uayk6DQogICAgICAgIHNlbGYucm9vdCA9IHJvb3QNCiAgICAgICAgc2VsZi5yb290LnRpdGxlKCJPcGVuR0wgVUkgRWRpdG9yIikNCiAgICAgICAgc2VsZi5yb290Lmdlb21ldHJ5KCIxMjAweDgwMCIpDQogICAgICAgIHNlbGYudmlzaWJsZV92YXIgPSBOb25lDQogICAgICAgIHNlbGYuY3VycmVudF9wcm9qZWN0ID0gUHJvamVjdCgpDQogICAgICAgIHNlbGYuY3VycmVudF9wcm9qZWN0LndpZHRoID0gODAwDQogICAgICAgIHNlbGYuY3VycmVudF9wcm9qZWN0LmhlaWdodCA9IDYwMA0KICAgICAgICBzZWxmLnNlbGVjdGVkX2VsZW1lbnQ6IE9wdGlvbmFsW1VJRWxlbWVudF0gPSBOb25lDQogICAgICAgIHNlbGYuY2FudmFzX3BhZGRpbmdfeCA9IDIwDQogICAgICAgIHNlbGYuY2FudmFzX3BhZGRpbmdfeSA9IDIwDQogICAgICAgIHNlbGYuZWxlbWVudF9wcm9wZXJ0aWVzID0ge30gICMgQWRkIHRoaXMgbGluZQ0KICAgICAgICBzZWxmLnNjZW5lX3Byb3BlcnRpZXMgPSB7fSAgICAjIEFkZCB0aGlzIGxpbmUNCiAgICAgICAgc2VsZi5wcm9qZWN0X3NldHRpbmdzID0ge30gICAgIyBBZGQgdGhpcyBsaW5lDQogICAgICAgIHNlbGYucGxhY2luZ19lbGVtZW50ID0gTm9uZQ0KICAgICAgICBzZWxmLnRlbXBfZWxlbWVudCA9IE5vbmUNCiAgICAgICAgDQogICAgICAgIHNlbGYuY3JlYXRlX3dpZGdldHMoKQ0KICAgICAgICBzZWxmLnNldHVwX2JpbmRpbmdzKCkNCg0KICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAjIFVJIENyZWF0aW9uIE1ldGhvZHMNCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoNCiAgICBkZWYgY3JlYXRlX3dpZGdldHMoc2VsZik6DQogICAgICAgIHNlbGYubWFpbl9wYW5lID0gdGsuUGFuZWRXaW5kb3coc2VsZi5yb290LCBvcmllbnQ9dGsuSE9SSVpPTlRBTCkNCiAgICAgICAgc2VsZi5tYWluX3BhbmUucGFjayhmaWxsPXRrLkJPVEgsIGV4cGFuZD1UcnVlKQ0KICAgICAgICANCiAgICAgICAgc2VsZi5sZWZ0X3BhbmVsID0gdHRrLkZyYW1lKHNlbGYubWFpbl9wYW5lLCB3aWR0aD0yNTApDQogICAgICAgIHNlbGYuY3JlYXRlX2hpZXJhcmNoeV9wYW5lbChzZWxmLmxlZnRfcGFuZWwpDQogICAgICAgIHNlbGYubWFpbl9wYW5lLmFkZChzZWxmLmxlZnRfcGFuZWwpDQogICAgICAgIA0KICAgICAgICBzZWxmLmNlbnRlcl9wYW5lbCA9IHR0ay5GcmFtZShzZWxmLm1haW5fcGFuZSkNCiAgICAgICAgc2VsZi5jcmVhdGVfd29ya3NwYWNlX25vdGVib29rKHNlbGYuY2VudGVyX3BhbmVsKQ0KICAgICAgICBzZWxmLm1haW5fcGFuZS5hZGQoc2VsZi5jZW50ZXJfcGFuZWwpDQogICAgICAgIA0KICAgICAgICBzZWxmLnJpZ2h0X3BhbmVsID0gdHRrLkZyYW1lKHNlbGYubWFpbl9wYW5lLCB3aWR0aD0zMDApDQogICAgICAgIHNlbGYuY3JlYXRlX3Byb3BlcnRpZXNfcGFuZWwoc2VsZi5yaWdodF9wYW5lbCkNCiAgICAgICAgc2VsZi5tYWluX3BhbmUuYWRkKHNlbGYucmlnaHRfcGFuZWwpDQoNCiAgICBkZWYgY3JlYXRlX3dvcmtzcGFjZV9ub3RlYm9vayhzZWxmLCBwYXJlbnQpOg0KICAgICAgICBzZWxmLndvcmtzcGFjZV9ub3RlYm9vayA9IHR0ay5Ob3RlYm9vayhwYXJlbnQpDQogICAgICAgIHNlbGYud29ya3NwYWNlX25vdGVib29rLnBhY2soZmlsbD10ay5CT1RILCBleHBhbmQ9VHJ1ZSkNCiAgICAgICAgDQogICAgICAgIHNlbGYudWlfcHJldmlld190YWIgPSB0dGsuRnJhbWUoc2VsZi53b3Jrc3BhY2Vfbm90ZWJvb2spDQogICAgICAgIHNlbGYud29ya3NwYWNlX25vdGVib29rLmFkZChzZWxmLnVpX3ByZXZpZXdfdGFiLCB0ZXh0PSJVSSBQcmV2aWV3IikNCiAgICAgICAgc2VsZi5jcmVhdGVfc2Nyb2xsYWJsZV93b3Jrc3BhY2Uoc2VsZi51aV9wcmV2aWV3X3RhYikNCiAgICAgICAgDQogICAgICAgICMgRXZlbnQgRWRpdG9yIHRhYiB3aXRoIGNvbnRhaW5lciBmcmFtZQ0KICAgICAgICBzZWxmLmV2ZW50X2VkaXRvcl90YWIgPSB0dGsuRnJhbWUoc2VsZi53b3Jrc3BhY2Vfbm90ZWJvb2spDQogICAgICAgIHNlbGYud29ya3NwYWNlX25vdGVib29rLmFkZChzZWxmLmV2ZW50X2VkaXRvcl90YWIsIHRleHQ9IkV2ZW50IEVkaXRvciIpDQogICAgICAgIA0KICAgICAgICBzZWxmLmV2ZW50X2VkaXRvcl9jb250YWluZXIgPSB0dGsuRnJhbWUoc2VsZi5ldmVudF9lZGl0b3JfdGFiKQ0KICAgICAgICBzZWxmLmV2ZW50X2VkaXRvcl9jb250YWluZXIucGFjayhmaWxsPXRrLkJPVEgsIGV4cGFuZD1UcnVlKQ0KICAgICAgICANCiAgICAgICAgIyBJbml0aWFsaXplIHRoZSBldmVudCBlZGl0b3INCiAgICAgICAgc2VsZi5ldmVudF9lZGl0b3IgPSBFdmVudEVkaXRvcihzZWxmLmV2ZW50X2VkaXRvcl9jb250YWluZXIpDQogICAgICAgIHNlbGYuZXZlbnRfZWRpdG9yLmN1cnJlbnRfcHJvamVjdCA9IHNlbGYuY3VycmVudF9wcm9qZWN0DQoNCiAgICBkZWYgY3JlYXRlX3Byb2plY3Rfc2V0dGluZ3NfdWkoc2VsZiwgcGFyZW50KToNCiAgICAgICAgIiIiRW5oYW5jZWQgcHJvamVjdCBzZXR0aW5ncyB3aXRoIGVkaXRvciBjb25maWd1cmF0aW9uIiIiDQogICAgICAgICMgUHJvamVjdCBkaXJlY3RvcnkNCiAgICAgICAgdHRrLkxhYmVsKHBhcmVudCwgdGV4dD0iUHJvamVjdCBQYXRoOiIpLmdyaWQocm93PTAsIGNvbHVtbj0wLCBzdGlja3k9dGsuVywgcGFkeD01LCBwYWR5PTIpDQogICAgICAgIHNlbGYucHJvamVjdF9wYXRoX2VudHJ5ID0gdHRrLkVudHJ5KHBhcmVudCkNCiAgICAgICAgc2VsZi5wcm9qZWN0X3BhdGhfZW50cnkuZ3JpZChyb3c9MCwgY29sdW1uPTEsIHN0aWNreT10ay5FVywgcGFkeD01LCBwYWR5PTIpDQogICAgICAgIA0KICAgICAgICAjIE1haW4gZmlsZQ0KICAgICAgICB0dGsuTGFiZWwocGFyZW50LCB0ZXh0PSJNYWluIEZpbGU6IikuZ3JpZChyb3c9MSwgY29sdW1uPTAsIHN0aWNreT10ay5XLCBwYWR4PTUsIHBhZHk9MikNCiAgICAgICAgc2VsZi5tYWluX2ZpbGVfZW50cnkgPSB0dGsuRW50cnkocGFyZW50KQ0KICAgICAgICBzZWxmLm1haW5fZmlsZV9lbnRyeS5ncmlkKHJvdz0xLCBjb2x1bW49MSwgc3RpY2t5PXRrLkVXLCBwYWR4PTUsIHBhZHk9MikNCiAgICAgICAgDQogICAgICAgICMgUHl0aG9uIHBhdGgNCiAgICAgICAgdHRrLkxhYmVsKHBhcmVudCwgdGV4dD0iUHl0aG9uIFBhdGg6IikuZ3JpZChyb3c9MiwgY29sdW1uPTAsIHN0aWNreT10ay5XLCBwYWR4PTUsIHBhZHk9MikNCiAgICAgICAgc2VsZi5weXRob25fcGF0aF9lbnRyeSA9IHR0ay5FbnRyeShwYXJlbnQpDQogICAgICAgIHNlbGYucHl0aG9uX3BhdGhfZW50cnkuZ3JpZChyb3c9MiwgY29sdW1uPTEsIHN0aWNreT10ay5FVywgcGFkeD01LCBwYWR5PTIpDQogICAgICAgIA0KICAgICAgICAjIFNhdmUgYnV0dG9uDQogICAgICAgICN0dGsuQnV0dG9uKHBhcmVudCwgdGV4dD0iU2F2ZSBTZXR0aW5ncyIsIGNvbW1hbmQ9c2VsZi5zYXZlX3Byb2plY3Rfc2V0dGluZ3MpLmdyaWQocm93PTMsIGNvbHVtbj0wLCBjb2x1bW5zcGFuPTIsIHBhZHk9MTApDQogICAgICAgIA0KICAgICAgICBwYXJlbnQuY29sdW1uY29uZmlndXJlKDEsIHdlaWdodD0xKQ0KICAgIA0KICAgIGRlZiBzYXZlX3Byb2plY3Rfc2V0dGluZ3Moc2VsZik6DQogICAgICAgICIiIlNhdmUgcHJvamVjdCBzZXR0aW5ncyBpbmNsdWRpbmcgZWRpdG9yIGNvbmZpZ3VyYXRpb24iIiINCiAgICAgICAgc2VsZi5jdXJyZW50X3Byb2plY3QucHJvamVjdF9kaXIgPSBzZWxmLnByb2plY3RfcGF0aF9lbnRyeS5nZXQoKQ0KICAgICAgICBzZWxmLmN1cnJlbnRfcHJvamVjdC5tYWluX2ZpbGUgPSBzZWxmLm1haW5fZmlsZV9lbnRyeS5nZXQoKQ0KICAgICAgICBzZWxmLmN1cnJlbnRfcHJvamVjdC5weXRob25fcGF0aCA9IHNlbGYucHl0aG9uX3BhdGhfZW50cnkuZ2V0KCkNCiAgICAgICAgDQogICAgICAgICMgVXBkYXRlIHRoZSBldmVudCBlZGl0b3Igd2l0aCBuZXcgc2V0dGluZ3MNCiAgICAgICAgaWYgaGFzYXR0cihzZWxmLCAnZXZlbnRfZWRpdG9yJyk6DQogICAgICAgICAgICBzZWxmLmV2ZW50X2VkaXRvci5jdXJyZW50X3Byb2plY3QgPSBzZWxmLmN1cnJlbnRfcHJvamVjdA0KICAgIGRlZiBjcmVhdGVfc2Nyb2xsYWJsZV93b3Jrc3BhY2Uoc2VsZiwgcGFyZW50KToNCiAgICAgICAgIiIiQ3JlYXRlIHNjcm9sbGFibGUgd29ya3NwYWNlIGFyZWEiIiINCiAgICAgICAgY29udGFpbmVyID0gdHRrLkZyYW1lKHBhcmVudCkNCiAgICAgICAgY29udGFpbmVyLnBhY2soZmlsbD10ay5CT1RILCBleHBhbmQ9VHJ1ZSkNCiAgICAgICAgDQogICAgICAgICMgQ3JlYXRlIHNjcm9sbGJhcnMNCiAgICAgICAgc2VsZi52c2Nyb2xsYmFyID0gdHRrLlNjcm9sbGJhcihjb250YWluZXIsIG9yaWVudD10ay5WRVJUSUNBTCkNCiAgICAgICAgc2VsZi5oc2Nyb2xsYmFyID0gdHRrLlNjcm9sbGJhcihjb250YWluZXIsIG9yaWVudD10ay5IT1JJWk9OVEFMKQ0KICAgICAgICANCiAgICAgICAgIyBDcmVhdGUgY2FudmFzIHdpdGggcHJvcGVyIHNjcm9sbHJlZ2lvbiBmb3JtYXR0aW5nDQogICAgICAgIHNlbGYud29ya3NwYWNlX2NhbnZhcyA9IHRrLkNhbnZhcygNCiAgICAgICAgICAgIGNvbnRhaW5lciwNCiAgICAgICAgICAgIGJnPSIjZTBlMGUwIiwNCiAgICAgICAgICAgIHlzY3JvbGxjb21tYW5kPXNlbGYudnNjcm9sbGJhci5zZXQsDQogICAgICAgICAgICB4c2Nyb2xsY29tbWFuZD1zZWxmLmhzY3JvbGxiYXIuc2V0LA0KICAgICAgICAgICAgc2Nyb2xscmVnaW9uPSgNCiAgICAgICAgICAgICAgICAwLCANCiAgICAgICAgICAgICAgICAwLCANCiAgICAgICAgICAgICAgICBzZWxmLmN1cnJlbnRfcHJvamVjdC53aWR0aCArICgyICogc2VsZi5jYW52YXNfcGFkZGluZ194KSwgDQogICAgICAgICAgICAgICAgc2VsZi5jdXJyZW50X3Byb2plY3QuaGVpZ2h0ICsgKDIgKiBzZWxmLmNhbnZhc19wYWRkaW5nX3kpDQogICAgICAgICAgICApDQogICAgICAgICkNCiAgICAgICAgDQogICAgICAgICMgTGF5b3V0IGNvbXBvbmVudHMNCiAgICAgICAgc2VsZi53b3Jrc3BhY2VfY2FudmFzLmdyaWQocm93PTAsIGNvbHVtbj0wLCBzdGlja3k9Im5zZXciKQ0KICAgICAgICBzZWxmLnZzY3JvbGxiYXIuZ3JpZChyb3c9MCwgY29sdW1uPTEsIHN0aWNreT0ibnMiKQ0KICAgICAgICBzZWxmLmhzY3JvbGxiYXIuZ3JpZChyb3c9MSwgY29sdW1uPTAsIHN0aWNreT0iZXciKQ0KICAgICAgICANCiAgICAgICAgIyBDb25maWd1cmUgc2Nyb2xsYmFycw0KICAgICAgICBzZWxmLnZzY3JvbGxiYXIuY29uZmlnKGNvbW1hbmQ9c2VsZi53b3Jrc3BhY2VfY2FudmFzLnl2aWV3KQ0KICAgICAgICBzZWxmLmhzY3JvbGxiYXIuY29uZmlnKGNvbW1hbmQ9c2VsZi53b3Jrc3BhY2VfY2FudmFzLnh2aWV3KQ0KICAgICAgICANCiAgICAgICAgIyBDb25maWd1cmUgZ3JpZCB3ZWlnaHRzDQogICAgICAgIGNvbnRhaW5lci5ncmlkX3Jvd2NvbmZpZ3VyZSgwLCB3ZWlnaHQ9MSkNCiAgICAgICAgY29udGFpbmVyLmdyaWRfY29sdW1uY29uZmlndXJlKDAsIHdlaWdodD0xKQ0KICAgICAgICANCiAgICAgICAgIyBDcmVhdGUgdGhlIHByb2plY3QgY2FudmFzDQogICAgICAgIHNlbGYuY2FudmFzID0gdGsuQ2FudmFzKA0KICAgICAgICAgICAgc2VsZi53b3Jrc3BhY2VfY2FudmFzLA0KICAgICAgICAgICAgYmc9IndoaXRlIiwNCiAgICAgICAgICAgIHdpZHRoPXNlbGYuY3VycmVudF9wcm9qZWN0LndpZHRoLA0KICAgICAgICAgICAgaGVpZ2h0PXNlbGYuY3VycmVudF9wcm9qZWN0LmhlaWdodCwNCiAgICAgICAgICAgIGhpZ2hsaWdodHRoaWNrbmVzcz0wDQogICAgICAgICkNCiAgICAgICAgDQogICAgICAgICMgUGxhY2UgdGhlIHByb2plY3QgY2FudmFzIHdpdGggcGFkZGluZw0KICAgICAgICBzZWxmLmNhbnZhc193aW5kb3cgPSBzZWxmLndvcmtzcGFjZV9jYW52YXMuY3JlYXRlX3dpbmRvdygNCiAgICAgICAgICAgIChzZWxmLmNhbnZhc19wYWRkaW5nX3gsIHNlbGYuY2FudmFzX3BhZGRpbmdfeSksDQogICAgICAgICAgICB3aW5kb3c9c2VsZi5jYW52YXMsDQogICAgICAgICAgICBhbmNob3I9Im53IiwNCiAgICAgICAgICAgIHRhZ3M9InByb2plY3RfY2FudmFzIg0KICAgICAgICApDQogICAgICAgIA0KICAgICAgICAjIEJpbmQgY29uZmlndXJhdGlvbiBldmVudHMNCiAgICAgICAgc2VsZi5jYW52YXMuYmluZCgiPENvbmZpZ3VyZT4iLCBzZWxmLm9uX3Byb2plY3RfY2FudmFzX2NvbmZpZ3VyZSkNCiAgICAgICAgc2VsZi53b3Jrc3BhY2VfY2FudmFzLmJpbmQoIjxDb25maWd1cmU+Iiwgc2VsZi5vbl93b3Jrc3BhY2VfY29uZmlndXJlKQ0KDQogICAgZGVmIGNyZWF0ZV9oaWVyYXJjaHlfcGFuZWwoc2VsZiwgcGFyZW50KToNCiAgICAgICAgc2NlbmVfZnJhbWUgPSB0dGsuTGFiZWxGcmFtZShwYXJlbnQsIHRleHQ9IlNjZW5lcyIsIHBhZGRpbmc9NSkNCiAgICAgICAgc2NlbmVfZnJhbWUucGFjayhmaWxsPXRrLlgsIHBhZHg9NSwgcGFkeT01KQ0KICAgICAgICANCiAgICAgICAgdHRrLkJ1dHRvbihzY2VuZV9mcmFtZSwgdGV4dD0iQWRkIFNjZW5lIiwgY29tbWFuZD1zZWxmLl9hZGRfc2NlbmUpLnBhY2soZmlsbD10ay5YLCBwYWR4PTUsIHBhZHk9MikNCiAgICAgICAgdHRrLkJ1dHRvbihzY2VuZV9mcmFtZSwgdGV4dD0iUmVtb3ZlIFNjZW5lIiwgY29tbWFuZD1zZWxmLl9yZW1vdmVfc2NlbmUpLnBhY2soZmlsbD10ay5YLCBwYWR4PTUsIHBhZHk9MikNCiAgICAgICAgDQogICAgICAgIGhpZXJhcmNoeV9mcmFtZSA9IHR0ay5MYWJlbEZyYW1lKHBhcmVudCwgdGV4dD0iSGllcmFyY2h5IiwgcGFkZGluZz01KQ0KICAgICAgICBoaWVyYXJjaHlfZnJhbWUucGFjayhmaWxsPXRrLkJPVEgsIGV4cGFuZD1UcnVlLCBwYWR4PTUsIHBhZHk9NSkNCiAgICAgICAgDQogICAgICAgIHNlbGYuaGllcmFyY2h5X3RyZWUgPSB0dGsuVHJlZXZpZXcoaGllcmFyY2h5X2ZyYW1lLCBjb2x1bW5zPSgidHlwZSIsKSkNCiAgICAgICAgc2VsZi5oaWVyYXJjaHlfdHJlZS5oZWFkaW5nKCIjMCIsIHRleHQ9Ik5hbWUiKQ0KICAgICAgICBzZWxmLmhpZXJhcmNoeV90cmVlLmhlYWRpbmcoInR5cGUiLCB0ZXh0PSJUeXBlIikNCiAgICAgICAgc2VsZi5oaWVyYXJjaHlfdHJlZS5jb2x1bW4oInR5cGUiLCB3aWR0aD0xMDApDQogICAgICAgIHNlbGYuaGllcmFyY2h5X3RyZWUucGFjayhmaWxsPXRrLkJPVEgsIGV4cGFuZD1UcnVlLCBwYWR4PTUsIHBhZHk9MikNCiAgICAgICAgc2VsZi5oaWVyYXJjaHlfdHJlZS5iaW5kKCI8PFRyZWV2aWV3U2VsZWN0Pj4iLCBzZWxmLm9uX2VsZW1lbnRfc2VsZWN0ZWQpDQogICAgICAgIA0KICAgICAgICBzZWxmLmNvbnRleHRfbWVudSA9IHRrLk1lbnUoc2VsZi5oaWVyYXJjaHlfdHJlZSwgdGVhcm9mZj0wKQ0KICAgICAgICBzZWxmLmNvbnRleHRfbWVudS5hZGRfY29tbWFuZChsYWJlbD0iQ29weSIsIGNvbW1hbmQ9c2VsZi5jb3B5X2VsZW1lbnQpDQogICAgICAgIHNlbGYuY29udGV4dF9tZW51LmFkZF9jb21tYW5kKGxhYmVsPSJQYXN0ZSIsIGNvbW1hbmQ9c2VsZi5wYXN0ZV9lbGVtZW50KQ0KICAgICAgICBzZWxmLmNvbnRleHRfbWVudS5hZGRfY29tbWFuZChsYWJlbD0iUmVtb3ZlIiwgY29tbWFuZD1zZWxmLnJlbW92ZV9zZWxlY3RlZF9lbGVtZW50KQ0KICAgICAgICBzZWxmLmhpZXJhcmNoeV90cmVlLmJpbmQoIjxCdXR0b24tMz4iLCBzZWxmLnNob3dfY29udGV4dF9tZW51KQ0KICAgICAgICANCiAgICAgICAgZWxlbWVudF9mcmFtZSA9IHR0ay5GcmFtZShwYXJlbnQsIHBhZGRpbmc9NSkNCiAgICAgICAgZWxlbWVudF9mcmFtZS5wYWNrKGZpbGw9dGsuWCwgcGFkeD01LCBwYWR5PTUpDQogICAgICAgIA0KICAgICAgICB0dGsuQnV0dG9uKGVsZW1lbnRfZnJhbWUsIHRleHQ9IkFkZCBQYW5lbCIsIGNvbW1hbmQ9bGFtYmRhOiBzZWxmLmFkZF91aV9lbGVtZW50KFBhbmVsKSkuZ3JpZChyb3c9MCwgY29sdW1uPTAsIHBhZHg9Miwgc3RpY2t5PXRrLkVXKQ0KICAgICAgICB0dGsuQnV0dG9uKGVsZW1lbnRfZnJhbWUsIHRleHQ9IkFkZCBCdXR0b24iLCBjb21tYW5kPWxhbWJkYTogc2VsZi5hZGRfdWlfZWxlbWVudChCdXR0b24pKS5ncmlkKHJvdz0wLCBjb2x1bW49MSwgcGFkeD0yLCBzdGlja3k9dGsuRVcpDQogICAgICAgIHR0ay5CdXR0b24oZWxlbWVudF9mcmFtZSwgdGV4dD0iQWRkIExhYmVsIiwgY29tbWFuZD1sYW1iZGE6IHNlbGYuYWRkX3VpX2VsZW1lbnQoTGFiZWwpKS5ncmlkKHJvdz0xLCBjb2x1bW49MCwgcGFkeD0yLCBzdGlja3k9dGsuRVcpDQogICAgICAgIHR0ay5CdXR0b24oZWxlbWVudF9mcmFtZSwgdGV4dD0iQWRkIFRleHRCb3giLCBjb21tYW5kPWxhbWJkYTogc2VsZi5hZGRfdWlfZWxlbWVudChUZXh0Qm94KSkuZ3JpZChyb3c9MSwgY29sdW1uPTEsIHBhZHg9Miwgc3RpY2t5PXRrLkVXKQ0KICAgICAgICANCiAgICAgICAgZWxlbWVudF9mcmFtZS5jb2x1bW5jb25maWd1cmUoMCwgd2VpZ2h0PTEpDQogICAgICAgIGVsZW1lbnRfZnJhbWUuY29sdW1uY29uZmlndXJlKDEsIHdlaWdodD0xKQ0KDQogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICMgRXZlbnQgSGFuZGxlcnMNCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgDQogICAgZGVmIHNldHVwX2JpbmRpbmdzKHNlbGYpOg0KICAgICAgICAiIiJTZXQgdXAga2V5Ym9hcmQgYW5kIG1vdXNlIGJpbmRpbmdzIGZvciB0aGUgZWRpdG9yIiIiDQogICAgICAgICMgQ2FudmFzIGJpbmRpbmdzIGZvciBlbGVtZW50IGludGVyYWN0aW9uDQogICAgICAgIHNlbGYuY2FudmFzLmJpbmQoIjxCdXR0b24tMT4iLCBzZWxmLm9uX2NhbnZhc19jbGljaykNCiAgICAgICAgc2VsZi5jYW52YXMuYmluZCgiPEIxLU1vdGlvbj4iLCBzZWxmLm9uX2NhbnZhc19kcmFnKQ0KICAgICAgICBzZWxmLmNhbnZhcy5iaW5kKCI8QnV0dG9uUmVsZWFzZS0xPiIsIHNlbGYub25fY2FudmFzX3JlbGVhc2UpDQogICAgICAgIA0KICAgICAgICAjIEtleWJvYXJkIHNob3J0Y3V0cw0KICAgICAgICBzZWxmLnJvb3QuYmluZCgiPERlbGV0ZT4iLCBsYW1iZGEgZTogc2VsZi5yZW1vdmVfc2VsZWN0ZWRfZWxlbWVudCgpKQ0KICAgICAgICBzZWxmLnJvb3QuYmluZCgiPENvbnRyb2wtcz4iLCBsYW1iZGEgZTogc2VsZi5zYXZlX3Byb2plY3QoKSkNCiAgICAgICAgc2VsZi5yb290LmJpbmQoIjxDb250cm9sLW8+IiwgbGFtYmRhIGU6IHNlbGYubG9hZF9wcm9qZWN0KCkpDQogICAgICAgIA0KICAgICAgICAjIFNlbGVjdGlvbiBoYW5kbGluZw0KICAgICAgICBzZWxmLmhpZXJhcmNoeV90cmVlLmJpbmQoIjw8VHJlZXZpZXdTZWxlY3Q+PiIsIHNlbGYub25fZWxlbWVudF9zZWxlY3RlZCkNCg0KICAgIGRlZiBvbl9jYW52YXNfY2xpY2soc2VsZiwgZXZlbnQpOg0KICAgICAgICAiIiJIYW5kbGUgbW91c2UgY2xpY2sgb24gY2FudmFzIiIiDQogICAgICAgIGlmIHNlbGYucGxhY2luZ19lbGVtZW50Og0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICANCiAgICAgICAgIyBGaW5kIGNsaWNrZWQgZWxlbWVudA0KICAgICAgICB4LCB5ID0gZXZlbnQueCwgZXZlbnQueQ0KICAgICAgICBzZWxmLnNlbGVjdGVkX2VsZW1lbnQgPSBzZWxmLl9nZXRfZWxlbWVudF9hdF9wb3NpdGlvbih4LCB5KQ0KICAgICAgICANCiAgICAgICAgaWYgc2VsZi5zZWxlY3RlZF9lbGVtZW50Og0KICAgICAgICAgICAgc2VsZi5kcmFnX3N0YXJ0X3BvcyA9ICh4LCB5KQ0KICAgICAgICAgICAgc2VsZi51cGRhdGVfZWxlbWVudF9wcm9wZXJ0aWVzKCkNCiAgICAgICAgICAgIHNlbGYucmVkcmF3X2NhbnZhcygpDQoNCiAgICBkZWYgb25fY2FudmFzX2RyYWcoc2VsZiwgZXZlbnQpOg0KICAgICAgICAiIiJIYW5kbGUgZWxlbWVudCBkcmFnZ2luZyBvbiBjYW52YXMiIiINCiAgICAgICAgaWYgbm90IGhhc2F0dHIoc2VsZiwgJ3NlbGVjdGVkX2VsZW1lbnQnKSBvciBub3Qgc2VsZi5zZWxlY3RlZF9lbGVtZW50Og0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICANCiAgICAgICAgeCwgeSA9IGV2ZW50LngsIGV2ZW50LnkNCiAgICAgICAgZHggPSB4IC0gc2VsZi5kcmFnX3N0YXJ0X3Bvc1swXQ0KICAgICAgICBkeSA9IHkgLSBzZWxmLmRyYWdfc3RhcnRfcG9zWzFdDQogICAgICAgIA0KICAgICAgICBzZWxmLnNlbGVjdGVkX2VsZW1lbnQueCArPSBkeA0KICAgICAgICBzZWxmLnNlbGVjdGVkX2VsZW1lbnQueSArPSBkeQ0KICAgICAgICBzZWxmLmRyYWdfc3RhcnRfcG9zID0gKHgsIHkpDQogICAgICAgIHNlbGYucmVkcmF3X2NhbnZhcygpDQoNCiAgICBkZWYgb25fY2FudmFzX3JlbGVhc2Uoc2VsZiwgZXZlbnQpOg0KICAgICAgICAiIiJIYW5kbGUgbW91c2UgcmVsZWFzZSBhZnRlciBkcmFnZ2luZyIiIg0KICAgICAgICBpZiBoYXNhdHRyKHNlbGYsICdkcmFnX3N0YXJ0X3BvcycpOg0KICAgICAgICAgICAgZGVsIHNlbGYuZHJhZ19zdGFydF9wb3MNCiAgICAgICAgc2VsZi51cGRhdGVfZWxlbWVudF9wcm9wZXJ0aWVzKCkNCg0KICAgIGRlZiBfYWRkX3NjZW5lKHNlbGYpOg0KICAgICAgICAiIiJBZGQgYSBuZXcgc2NlbmUgdG8gdGhlIHByb2plY3QiIiINCiAgICAgICAgc2NlbmVfY291bnQgPSBsZW4oc2VsZi5jdXJyZW50X3Byb2plY3Quc2NlbmVfbWFuYWdlci5zY2VuZXMpICsgMQ0KICAgICAgICBzY2VuZV9uYW1lID0gZiJTY2VuZV97c2NlbmVfY291bnR9Ig0KICAgICAgICANCiAgICAgICAgc2NlbmUgPSBTY2VuZShzY2VuZV9uYW1lKQ0KICAgICAgICBzZWxmLmN1cnJlbnRfcHJvamVjdC5zY2VuZV9tYW5hZ2VyLmFkZF9zY2VuZShzY2VuZSkNCiAgICAgICAgc2VsZi5jdXJyZW50X3Byb2plY3Quc2NlbmVfbWFuYWdlci5zZXRfY3VycmVudF9zY2VuZShzY2VuZV9uYW1lKQ0KICAgICAgICANCiAgICAgICAgc2VsZi5yZWZyZXNoX2hpZXJhcmNoeV92aXN1YWxzKCkNCiAgICAgICAgc2VsZi51cGRhdGVfc2NlbmVfcHJvcGVydGllcygpDQogICAgICAgIA0KICAgICAgICAjIFNlbGVjdCB0aGUgbmV3IHNjZW5lIGluIGhpZXJhcmNoeQ0KICAgICAgICBzY2VuZV9ub2RlX2lkID0gZiJzY2VuZV97c2NlbmVfbmFtZX0iDQogICAgICAgIGZvciBjaGlsZCBpbiBzZWxmLmhpZXJhcmNoeV90cmVlLmdldF9jaGlsZHJlbigpOg0KICAgICAgICAgICAgaWYgc2VsZi5oaWVyYXJjaHlfdHJlZS5pdGVtKGNoaWxkLCAndGFncycpWzBdID09IHNjZW5lX25vZGVfaWQ6DQogICAgICAgICAgICAgICAgc2VsZi5oaWVyYXJjaHlfdHJlZS5zZWxlY3Rpb25fc2V0KGNoaWxkKQ0KICAgICAgICAgICAgICAgIHNlbGYuaGllcmFyY2h5X3RyZWUuZm9jdXMoY2hpbGQpDQogICAgICAgICAgICAgICAgYnJlYWsNCg0KICAgIGRlZiBfcmVtb3ZlX3NjZW5lKHNlbGYpOg0KICAgICAgICAiIiJSZW1vdmUgdGhlIGN1cnJlbnRseSBzZWxlY3RlZCBzY2VuZSIiIg0KICAgICAgICBzZWxlY3RlZF9pdGVtID0gc2VsZi5oaWVyYXJjaHlfdHJlZS5mb2N1cygpDQogICAgICAgIGlmIG5vdCBzZWxlY3RlZF9pdGVtOg0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIA0KICAgICAgICB0YWdzID0gc2VsZi5oaWVyYXJjaHlfdHJlZS5pdGVtKHNlbGVjdGVkX2l0ZW0sICd0YWdzJykNCiAgICAgICAgaWYgbm90IHRhZ3Mgb3Igbm90IHRhZ3NbMF0uc3RhcnRzd2l0aCgic2NlbmVfIik6DQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgDQogICAgICAgIHNjZW5lX25hbWUgPSB0YWdzWzBdWzY6XQ0KICAgICAgICBpZiBtZXNzYWdlYm94LmFza3llc25vKCJDb25maXJtIiwgZiJEZWxldGUgc2NlbmUgJ3tzY2VuZV9uYW1lfSc/Iik6DQogICAgICAgICAgICBzZWxmLmN1cnJlbnRfcHJvamVjdC5zY2VuZV9tYW5hZ2VyLnJlbW92ZV9zY2VuZShzY2VuZV9uYW1lKQ0KICAgICAgICAgICAgc2VsZi5yZWZyZXNoX2hpZXJhcmNoeV92aXN1YWxzKCkNCiAgICAgICAgICAgIHNlbGYuc2VsZWN0ZWRfZWxlbWVudCA9IE5vbmUNCiAgICAgICAgICAgIHNlbGYudXBkYXRlX2VsZW1lbnRfcHJvcGVydGllcygpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIHNlbGYuY3VycmVudF9wcm9qZWN0LnNjZW5lX21hbmFnZXIuc2NlbmVzOg0KICAgICAgICAgICAgICAgIGZpcnN0X3NjZW5lID0gbmV4dChpdGVyKHNlbGYuY3VycmVudF9wcm9qZWN0LnNjZW5lX21hbmFnZXIuc2NlbmVzLnZhbHVlcygpKSkNCiAgICAgICAgICAgICAgICBzZWxmLmN1cnJlbnRfcHJvamVjdC5zY2VuZV9tYW5hZ2VyLnNldF9jdXJyZW50X3NjZW5lKGZpcnN0X3NjZW5lLm5hbWUpDQogICAgICAgICAgICAgICAgc2VsZi51cGRhdGVfc2NlbmVfcHJvcGVydGllcygpDQogICAgDQogICAgZGVmIG9uX3Byb2plY3RfY2FudmFzX2NvbmZpZ3VyZShzZWxmLCBldmVudCk6DQogICAgICAgICIiIlVwZGF0ZSBzY3JvbGwgcmVnaW9uIHdoZW4gcHJvamVjdCBjYW52YXMgY2hhbmdlcyBzaXplIiIiDQogICAgICAgIHRvdGFsX3dpZHRoID0gc2VsZi5jdXJyZW50X3Byb2plY3Qud2lkdGggKyAoMiAqIHNlbGYuY2FudmFzX3BhZGRpbmdfeCkNCiAgICAgICAgdG90YWxfaGVpZ2h0ID0gc2VsZi5jdXJyZW50X3Byb2plY3QuaGVpZ2h0ICsgKDIgKiBzZWxmLmNhbnZhc19wYWRkaW5nX3kpDQogICAgICAgIHNlbGYud29ya3NwYWNlX2NhbnZhcy5jb25maWd1cmUoc2Nyb2xscmVnaW9uPSgwLCAwLCB0b3RhbF93aWR0aCwgdG90YWxfaGVpZ2h0KSkNCg0KICAgIGRlZiBvbl93b3Jrc3BhY2VfY29uZmlndXJlKHNlbGYsIGV2ZW50KToNCiAgICAgICAgIiIiSGFuZGxlIHdvcmtzcGFjZSBjYW52YXMgcmVzaXppbmciIiINCiAgICAgICAgcGFzcw0KDQogICAgZGVmIG9uX2VsZW1lbnRfc2VsZWN0ZWQoc2VsZiwgZXZlbnQpOg0KICAgICAgICAiIiJIYW5kbGUgc2VsZWN0aW9uIGluIGhpZXJhcmNoeSB0cmVlIiIiDQogICAgICAgIHNlbGVjdGVkX2l0ZW0gPSBzZWxmLmhpZXJhcmNoeV90cmVlLmZvY3VzKCkNCiAgICAgICAgaWYgbm90IHNlbGVjdGVkX2l0ZW06DQogICAgICAgICAgICBzZWxmLnNlbGVjdGVkX2VsZW1lbnQgPSBOb25lDQogICAgICAgICAgICBzZWxmLnVwZGF0ZV9lbGVtZW50X3Byb3BlcnRpZXMoKQ0KICAgICAgICAgICAgcmV0dXJuDQoNCiAgICAgICAgdGFncyA9IHNlbGYuaGllcmFyY2h5X3RyZWUuaXRlbShzZWxlY3RlZF9pdGVtLCAndGFncycpDQogICAgICAgIGlmIG5vdCB0YWdzOg0KICAgICAgICAgICAgcmV0dXJuDQoNCiAgICAgICAgaWYgdGFnc1swXS5zdGFydHN3aXRoKCJzY2VuZV8iKToNCiAgICAgICAgICAgIHNjZW5lX25hbWUgPSB0YWdzWzBdWzY6XQ0KICAgICAgICAgICAgc2NlbmUgPSBzZWxmLmN1cnJlbnRfcHJvamVjdC5zY2VuZV9tYW5hZ2VyLnNjZW5lcy5nZXQoc2NlbmVfbmFtZSkNCiAgICAgICAgICAgIGlmIHNjZW5lOg0KICAgICAgICAgICAgICAgIHNlbGYuY3VycmVudF9wcm9qZWN0LnNjZW5lX21hbmFnZXIuc2V0X2N1cnJlbnRfc2NlbmUoc2NlbmVfbmFtZSkNCiAgICAgICAgICAgICAgICBzZWxmLnNlbGVjdGVkX2VsZW1lbnQgPSBOb25lDQogICAgICAgICAgICAgICAgc2VsZi51cGRhdGVfc2NlbmVfcHJvcGVydGllcygpDQogICAgICAgICAgICAgICAgc2VsZi51cGRhdGVfZWxlbWVudF9wcm9wZXJ0aWVzKCkNCiAgICAgICAgICAgICAgICBzZWxmLm5vdGVib29rLnNlbGVjdChzZWxmLnNjZW5lX3Byb3BlcnRpZXNfZnJhbWUpDQogICAgICAgICAgICAgICAgc2VsZi5yZWRyYXdfY2FudmFzKCkNCiAgICAgICAgICAgIHJldHVybg0KDQogICAgICAgIGVsZW1lbnRfaWQgPSB0YWdzWzBdWzg6XSBpZiB0YWdzWzBdLnN0YXJ0c3dpdGgoImVsZW1lbnRfIikgZWxzZSB0YWdzWzBdDQogICAgICAgIGVsZW1lbnQgPSBzZWxmLmZpbmRfZWxlbWVudF9ieV9pZChlbGVtZW50X2lkKQ0KDQogICAgICAgIGlmIGVsZW1lbnQ6DQogICAgICAgICAgICBzY2VuZSA9IHNlbGYuZ2V0X2VsZW1lbnRfc2NlbmUoZWxlbWVudCkNCiAgICAgICAgICAgIGlmIHNjZW5lOg0KICAgICAgICAgICAgICAgIHNlbGYuY3VycmVudF9wcm9qZWN0LnNjZW5lX21hbmFnZXIuc2V0X2N1cnJlbnRfc2NlbmUoc2NlbmUubmFtZSkNCiAgICAgICAgICAgIHNlbGYuc2VsZWN0ZWRfZWxlbWVudCA9IGVsZW1lbnQNCiAgICAgICAgICAgIHNlbGYudXBkYXRlX3NjZW5lX3Byb3BlcnRpZXMoKQ0KICAgICAgICAgICAgc2VsZi51cGRhdGVfZWxlbWVudF9wcm9wZXJ0aWVzKCkNCiAgICAgICAgICAgIHNlbGYubm90ZWJvb2suc2VsZWN0KHNlbGYuZWxlbWVudF9wcm9wZXJ0aWVzX2ZyYW1lKQ0KICAgICAgICAgICAgc2VsZi5yZWRyYXdfY2FudmFzKCkNCg0KICAgIGRlZiBzaG93X2NvbnRleHRfbWVudShzZWxmLCBldmVudCk6DQogICAgICAgICIiIkRpc3BsYXkgY29udGV4dCBtZW51IG9uIHJpZ2h0LWNsaWNrIiIiDQogICAgICAgIGl0ZW0gPSBzZWxmLmhpZXJhcmNoeV90cmVlLmlkZW50aWZ5X3JvdyhldmVudC55KQ0KICAgICAgICBpZiBpdGVtOg0KICAgICAgICAgICAgc2VsZi5oaWVyYXJjaHlfdHJlZS5zZWxlY3Rpb25fc2V0KGl0ZW0pDQogICAgICAgICAgICBzZWxmLmNvbnRleHRfbWVudS5wb3N0KGV2ZW50Lnhfcm9vdCwgZXZlbnQueV9yb290KQ0KDQogICAgZGVmIGNvcHlfZWxlbWVudChzZWxmKToNCiAgICAgICAgIiIiQ29weSBzZWxlY3RlZCBlbGVtZW50IHRvIGNsaXBib2FyZCIiIg0KICAgICAgICBpZiBzZWxmLnNlbGVjdGVkX2VsZW1lbnQ6DQogICAgICAgICAgICBzZWxmLmNsaXBib2FyZCA9IHNlbGYuc2VsZWN0ZWRfZWxlbWVudA0KICAgICAgICAgICAgcHJpbnQoZiJDb3BpZWQ6IHtzZWxmLnNlbGVjdGVkX2VsZW1lbnQubmFtZX0iKQ0KDQogICAgZGVmIHBhc3RlX2VsZW1lbnQoc2VsZik6DQogICAgICAgICIiIlBhc3RlIGVsZW1lbnQgZnJvbSBjbGlwYm9hcmQiIiINCiAgICAgICAgaWYgaGFzYXR0cihzZWxmLCAnY2xpcGJvYXJkJykgYW5kIHNlbGYuY2xpcGJvYXJkOg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGltcG9ydCBjb3B5DQogICAgICAgICAgICAgICAgZWxlbWVudF9jb3B5ID0gY29weS5kZWVwY29weShzZWxmLmNsaXBib2FyZCkNCiAgICAgICAgICAgICAgICBlbGVtZW50X2NvcHkubmFtZSA9IGYie2VsZW1lbnRfY29weS5uYW1lfV9jb3B5Ig0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHNlbGVjdGVkX2l0ZW0gPSBzZWxmLmhpZXJhcmNoeV90cmVlLmZvY3VzKCkNCiAgICAgICAgICAgICAgICBpZiBzZWxlY3RlZF9pdGVtOg0KICAgICAgICAgICAgICAgICAgICB0YWdzID0gc2VsZi5oaWVyYXJjaHlfdHJlZS5pdGVtKHNlbGVjdGVkX2l0ZW0sICd0YWdzJykNCiAgICAgICAgICAgICAgICAgICAgaWYgdGFnczoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRhZ3NbMF0uc3RhcnRzd2l0aCgic2NlbmVfIik6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NlbmUgPSBzZWxmLmN1cnJlbnRfcHJvamVjdC5zY2VuZV9tYW5hZ2VyLnNjZW5lc1t0YWdzWzBdWzY6XV0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2VuZS5lbGVtZW50cy5hcHBlbmQoZWxlbWVudF9jb3B5KQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50ID0gc2VsZi5maW5kX2VsZW1lbnRfYnlfaWQodGFnc1swXSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGVsZW1lbnQsIENvbnRhaW5lckVsZW1lbnQpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFkZF9jaGlsZChlbGVtZW50X2NvcHkpDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgc2VsZi5yZWZyZXNoX2hpZXJhcmNoeV92aXN1YWxzKCkNCiAgICAgICAgICAgICAgICBzZWxmLnJlZHJhd19jYW52YXMoKQ0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2Vycm9yKCJFcnJvciIsIGYiRmFpbGVkIHRvIHBhc3RlIGVsZW1lbnQ6IHtzdHIoZSl9IikNCg0KICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAjIEVsZW1lbnQgTWFuYWdlbWVudA0KICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICANCiAgICBkZWYgX2dldF9lbGVtZW50X2F0X3Bvc2l0aW9uKHNlbGYsIHgsIHkpOg0KICAgICAgICAiIiJGaW5kIGVsZW1lbnQgYXQgZ2l2ZW4gY2FudmFzIGNvb3JkaW5hdGVzIiIiDQogICAgICAgIHNjZW5lID0gc2VsZi5jdXJyZW50X3Byb2plY3Quc2NlbmVfbWFuYWdlci5jdXJyZW50X3NjZW5lDQogICAgICAgIGlmIG5vdCBzY2VuZToNCiAgICAgICAgICAgIHJldHVybiBOb25lDQogICAgICAgICAgICANCiAgICAgICAgIyBDaGVjayBlbGVtZW50cyBpbiByZXZlcnNlIGRyYXcgb3JkZXIgKHRvcC1tb3N0IGZpcnN0KQ0KICAgICAgICBmb3IgZWxlbWVudCBpbiByZXZlcnNlZChzY2VuZS5lbGVtZW50cyArIHNjZW5lLnBhbmVscyk6DQogICAgICAgICAgICBpZiBzZWxmLl9pc19wb2ludF9pbl9lbGVtZW50KHgsIHksIGVsZW1lbnQpOg0KICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50DQogICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgX2lzX3BvaW50X2luX2VsZW1lbnQoc2VsZiwgeCwgeSwgZWxlbWVudCk6DQogICAgICAgICIiIkNoZWNrIGlmIHBvaW50IGlzIGluc2lkZSBhbiBlbGVtZW50J3MgYm91bmRzIiIiDQogICAgICAgIGFic194LCBhYnNfeSA9IGVsZW1lbnQuZ2V0X2Fic29sdXRlX3Bvc2l0aW9uKCkNCiAgICAgICAgcmV0dXJuIChhYnNfeCA8PSB4IDw9IGFic194ICsgZWxlbWVudC53aWR0aCBhbmQNCiAgICAgICAgICAgICAgICBhYnNfeSA8PSB5IDw9IGFic195ICsgZWxlbWVudC5oZWlnaHQpDQogICAgDQogICAgZGVmIGFkZF91aV9lbGVtZW50KHNlbGYsIGVsZW1lbnRfY2xhc3MpOg0KICAgICAgICAiIiJFbnRlciBwbGFjZW1lbnQgbW9kZSBmb3IgbmV3IGVsZW1lbnQiIiINCiAgICAgICAgc2VsZi5wbGFjaW5nX2VsZW1lbnQgPSBlbGVtZW50X2NsYXNzDQogICAgICAgIHNlbGYudGVtcF9lbGVtZW50ID0gc2VsZi5jYW52YXMuY3JlYXRlX3JlY3RhbmdsZSgNCiAgICAgICAgICAgIDAsIDAsIDEwMCwgNTAsIGZpbGw9ImdyZXkiLCBzdGlwcGxlPSJncmF5NTAiDQogICAgICAgICkNCiAgICAgICAgc2VsZi5jYW52YXMuYmluZCgiPE1vdGlvbj4iLCBzZWxmLnVwZGF0ZV90ZW1wX2VsZW1lbnRfcG9zaXRpb24pDQogICAgICAgIHNlbGYuY2FudmFzLmJpbmQoIjxCdXR0b24tMT4iLCBzZWxmLmZpbmFsaXplX2VsZW1lbnRfcGxhY2VtZW50KQ0KICAgICAgICBzZWxmLmNhbnZhcy5iaW5kKCI8RXNjYXBlPiIsIHNlbGYuY2FuY2VsX2VsZW1lbnRfcGxhY2VtZW50KQ0KDQogICAgZGVmIHVwZGF0ZV90ZW1wX2VsZW1lbnRfcG9zaXRpb24oc2VsZiwgZXZlbnQpOg0KICAgICAgICAiIiJVcGRhdGUgdGVtcG9yYXJ5IGVsZW1lbnQgcG9zaXRpb24gZHVyaW5nIHBsYWNlbWVudCIiIg0KICAgICAgICBpZiBzZWxmLnRlbXBfZWxlbWVudDoNCiAgICAgICAgICAgIHgxLCB5MSA9IGV2ZW50LngsIGV2ZW50LnkNCiAgICAgICAgICAgIHgyLCB5MiA9IHgxICsgMTAwLCB5MSArIDUwDQogICAgICAgICAgICBzZWxmLmNhbnZhcy5jb29yZHMoc2VsZi50ZW1wX2VsZW1lbnQsIHgxLCB5MSwgeDIsIHkyKQ0KDQogICAgZGVmIGZpbmFsaXplX2VsZW1lbnRfcGxhY2VtZW50KHNlbGYsIGV2ZW50KToNCiAgICAgICAgIiIiRmluYWxpemUgZWxlbWVudCBwbGFjZW1lbnQgb24gY2FudmFzIiIiDQogICAgICAgIGlmIG5vdCBzZWxmLnBsYWNpbmdfZWxlbWVudDoNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICANCiAgICAgICAgeCwgeSA9IGV2ZW50LngsIGV2ZW50LnkNCiAgICAgICAgc2VsZi5jYW52YXMuZGVsZXRlKHNlbGYudGVtcF9lbGVtZW50KQ0KICAgICAgICANCiAgICAgICAgdGFyZ2V0X3NjZW5lID0gc2VsZi5jdXJyZW50X3Byb2plY3Quc2NlbmVfbWFuYWdlci5jdXJyZW50X3NjZW5lDQogICAgICAgIGlmIG5vdCB0YXJnZXRfc2NlbmU6DQogICAgICAgICAgICByZXR1cm4NCg0KICAgICAgICAjIEZpeGVkIHRoaXMgbGluZSAtIHByb3Blcmx5IGNsb3NlZCBwYXJlbnRoZXNpcw0KICAgICAgICBlbGVtZW50X2NvdW50ID0gc3VtKA0KICAgICAgICAgICAgMSBmb3IgZWxlbWVudCBpbiB0YXJnZXRfc2NlbmUuZWxlbWVudHMgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGVsZW1lbnQsIHNlbGYucGxhY2luZ19lbGVtZW50KQ0KICAgICAgICApDQogICAgICAgIA0KICAgICAgICBlbGVtZW50X25hbWUgPSBmIntzZWxmLnBsYWNpbmdfZWxlbWVudC5fX25hbWVfX31fe2VsZW1lbnRfY291bnR9Ig0KICAgICAgICBuZXdfZWxlbWVudCA9IHNlbGYucGxhY2luZ19lbGVtZW50KGVsZW1lbnRfbmFtZSwgeD14LCB5PXkpDQogICAgICAgIHRhcmdldF9zY2VuZS5lbGVtZW50cy5hcHBlbmQobmV3X2VsZW1lbnQpDQogICAgICAgIA0KICAgICAgICBzZWxmLnJlZnJlc2hfaGllcmFyY2h5X3Zpc3VhbHMoKQ0KICAgICAgICBzZWxmLnJlZHJhd19jYW52YXMoKQ0KICAgICAgICBzZWxmLnBsYWNpbmdfZWxlbWVudCA9IE5vbmUNCiAgICAgICAgc2VsZi50ZW1wX2VsZW1lbnQgPSBOb25lDQogICAgICAgIHNlbGYuY2FudmFzLnVuYmluZCgiPE1vdGlvbj4iKQ0KICAgICAgICBzZWxmLmNhbnZhcy51bmJpbmQoIjxCdXR0b24tMT4iKQ0KICAgICAgICBzZWxmLmNhbnZhcy51bmJpbmQoIjxFc2NhcGU+IikNCg0KICAgIGRlZiBjYW5jZWxfZWxlbWVudF9wbGFjZW1lbnQoc2VsZiwgZXZlbnQpOg0KICAgICAgICAiIiJDYW5jZWwgZWxlbWVudCBwbGFjZW1lbnQiIiINCiAgICAgICAgc2VsZi5jYW52YXMuZGVsZXRlKHNlbGYudGVtcF9lbGVtZW50KQ0KICAgICAgICBzZWxmLnBsYWNpbmdfZWxlbWVudCA9IE5vbmUNCiAgICAgICAgc2VsZi50ZW1wX2VsZW1lbnQgPSBOb25lDQogICAgICAgIHNlbGYuY2FudmFzLnVuYmluZCgiPE1vdGlvbj4iKQ0KICAgICAgICBzZWxmLmNhbnZhcy51bmJpbmQoIjxCdXR0b24tMT4iKQ0KICAgICAgICBzZWxmLmNhbnZhcy51bmJpbmQoIjxFc2NhcGU+IikNCg0KICAgIGRlZiByZW1vdmVfc2VsZWN0ZWRfZWxlbWVudChzZWxmKToNCiAgICAgICAgIiIiUmVtb3ZlIGN1cnJlbnRseSBzZWxlY3RlZCBlbGVtZW50IiIiDQogICAgICAgIGlmIHNlbGYuc2VsZWN0ZWRfZWxlbWVudDoNCiAgICAgICAgICAgIHNjZW5lID0gc2VsZi5nZXRfZWxlbWVudF9zY2VuZShzZWxmLnNlbGVjdGVkX2VsZW1lbnQpDQogICAgICAgICAgICBpZiBzY2VuZToNCiAgICAgICAgICAgICAgICBpZiBzZWxmLnNlbGVjdGVkX2VsZW1lbnQgaW4gc2NlbmUuZWxlbWVudHM6DQogICAgICAgICAgICAgICAgICAgIHNjZW5lLmVsZW1lbnRzLnJlbW92ZShzZWxmLnNlbGVjdGVkX2VsZW1lbnQpDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgZm9yIHBhbmVsIGluIHNjZW5lLnBhbmVsczoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuc2VsZWN0ZWRfZWxlbWVudCBpbiBwYW5lbC5jaGlsZHJlbjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYW5lbC5jaGlsZHJlbi5yZW1vdmUoc2VsZi5zZWxlY3RlZF9lbGVtZW50KQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlZnJlc2hfaGllcmFyY2h5X3Zpc3VhbHMoKQ0KICAgICAgICAgICAgc2VsZi5yZWRyYXdfY2FudmFzKCkNCiAgICAgICAgICAgIHNlbGYuc2VsZWN0ZWRfZWxlbWVudCA9IE5vbmUNCiAgICAgICAgICAgIHNlbGYudXBkYXRlX2VsZW1lbnRfcHJvcGVydGllcygpDQoNCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgIyBQcm9wZXJ0eSBNYW5hZ2VtZW50DQogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQogICAgZGVmIGNyZWF0ZV9wcm9wZXJ0aWVzX3BhbmVsKHNlbGYsIHBhcmVudCk6DQogICAgICAgICIiIkNyZWF0ZSB0aGUgcHJvcGVydGllcyBub3RlYm9vayB3aXRoIHRhYnMiIiINCiAgICAgICAgc2VsZi5ub3RlYm9vayA9IHR0ay5Ob3RlYm9vayhwYXJlbnQpDQogICAgICAgIHNlbGYubm90ZWJvb2sucGFjayhmaWxsPXRrLkJPVEgsIGV4cGFuZD1UcnVlLCBwYWR4PTUsIHBhZHk9NSkNCiAgICAgICAgDQogICAgICAgICMgRWxlbWVudCBQcm9wZXJ0aWVzIFRhYg0KICAgICAgICBzZWxmLmVsZW1lbnRfcHJvcGVydGllc19mcmFtZSA9IHR0ay5GcmFtZShzZWxmLm5vdGVib29rKQ0KICAgICAgICBzZWxmLm5vdGVib29rLmFkZChzZWxmLmVsZW1lbnRfcHJvcGVydGllc19mcmFtZSwgdGV4dD0iRWxlbWVudCBQcm9wZXJ0aWVzIikNCiAgICAgICAgc2VsZi5jcmVhdGVfZWxlbWVudF9wcm9wZXJ0aWVzX3VpKHNlbGYuZWxlbWVudF9wcm9wZXJ0aWVzX2ZyYW1lKQ0KICAgICAgICANCiAgICAgICAgIyBTY2VuZSBQcm9wZXJ0aWVzIFRhYg0KICAgICAgICBzZWxmLnNjZW5lX3Byb3BlcnRpZXNfZnJhbWUgPSB0dGsuRnJhbWUoc2VsZi5ub3RlYm9vaykNCiAgICAgICAgc2VsZi5ub3RlYm9vay5hZGQoc2VsZi5zY2VuZV9wcm9wZXJ0aWVzX2ZyYW1lLCB0ZXh0PSJTY2VuZSBQcm9wZXJ0aWVzIikNCiAgICAgICAgc2VsZi5jcmVhdGVfc2NlbmVfcHJvcGVydGllc191aShzZWxmLnNjZW5lX3Byb3BlcnRpZXNfZnJhbWUpDQogICAgICAgIA0KICAgICAgICAjIFByb2plY3QgU2V0dGluZ3MgVGFiDQogICAgICAgIHNlbGYucHJvamVjdF9zZXR0aW5nc19mcmFtZSA9IHR0ay5GcmFtZShzZWxmLm5vdGVib29rKQ0KICAgICAgICBzZWxmLm5vdGVib29rLmFkZChzZWxmLnByb2plY3Rfc2V0dGluZ3NfZnJhbWUsIHRleHQ9IlByb2plY3QgU2V0dGluZ3MiKQ0KICAgICAgICBzZWxmLmNyZWF0ZV9wcm9qZWN0X3NldHRpbmdzX3VpKHNlbGYucHJvamVjdF9zZXR0aW5nc19mcmFtZSkNCg0KICAgIGRlZiBjcmVhdGVfZWxlbWVudF9wcm9wZXJ0aWVzX3VpKHNlbGYsIHBhcmVudCk6DQogICAgICAgICIiIkNyZWF0ZSB0aGUgZWxlbWVudCBwcm9wZXJ0aWVzIGVkaXRpbmcgVUkiIiINCiAgICAgICAgc2VsZi5lbGVtZW50X3Byb3BlcnRpZXMgPSB7fSAgIyBJbml0aWFsaXplIGlmIG5vdCBhbHJlYWR5IGRvbmUNCiAgICAgICAgDQogICAgICAgICMgQ29tbW9uIHByb3BlcnRpZXMgZnJhbWUNCiAgICAgICAgY29tbW9uX2ZyYW1lID0gdHRrLkxhYmVsRnJhbWUocGFyZW50LCB0ZXh0PSJDb21tb24gUHJvcGVydGllcyIsIHBhZGRpbmc9NSkNCiAgICAgICAgY29tbW9uX2ZyYW1lLnBhY2soZmlsbD10ay5YLCBwYWR4PTUsIHBhZHk9NSkNCiAgICAgICAgDQogICAgICAgICMgQ3JlYXRlIGFsbCBwcm9wZXJ0eSBmaWVsZHMNCiAgICAgICAgcHJvcGVydGllcyA9IFsNCiAgICAgICAgICAgICgnTmFtZTonLCAnbmFtZScsICdlbnRyeScpLA0KICAgICAgICAgICAgKCdYOicsICd4JywgJ3NwaW5ib3gnLCAwLCAxMDAwMCksDQogICAgICAgICAgICAoJ1k6JywgJ3knLCAnc3BpbmJveCcsIDAsIDEwMDAwKSwNCiAgICAgICAgICAgICgnV2lkdGg6JywgJ3dpZHRoJywgJ3NwaW5ib3gnLCAxLCAxMDAwMCksDQogICAgICAgICAgICAoJ0hlaWdodDonLCAnaGVpZ2h0JywgJ3NwaW5ib3gnLCAxLCAxMDAwMCksDQogICAgICAgICAgICAoJ0Nvcm5lciBSYWRpdXM6JywgJ2Nvcm5lcl9yYWRpdXMnLCAnc3BpbmJveCcsIDAsIDEwMCksDQogICAgICAgICAgICAoJ0JhY2tncm91bmQgQ29sb3I6JywgJ2JhY2tncm91bmRfY29sb3InLCAnY29sb3InKSwNCiAgICAgICAgICAgICgnQm9yZGVyIFRoaWNrbmVzcycsICdib3JkZXJfdGhpY2tuZXNzJywgJ3NwaW5ib3gnLCAwLCAxMDApLA0KICAgICAgICAgICAgKCdCb3JkZXIgQ29sb3I6JywgJ2JvcmRlcl9jb2xvcicsICdjb2xvcicpLA0KICAgICAgICAgICAgKCdUZXh0IENvbG9yOicsICd0ZXh0X2NvbG9yJywgJ2NvbG9yJyksDQogICAgICAgICAgICAoJ1RleHQnLCAndGV4dCcsICdlbnRyeScpDQogICAgICAgIF0NCiAgICAgICAgDQogICAgICAgIGZvciByb3csIChsYWJlbCwgcHJvcCwgZmllbGRfdHlwZSwgKmFyZ3MpIGluIGVudW1lcmF0ZShwcm9wZXJ0aWVzKToNCiAgICAgICAgICAgIHR0ay5MYWJlbChjb21tb25fZnJhbWUsIHRleHQ9bGFiZWwpLmdyaWQocm93PXJvdywgY29sdW1uPTAsIHN0aWNreT10ay5XKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiBmaWVsZF90eXBlID09ICdlbnRyeSc6DQogICAgICAgICAgICAgICAgc2VsZi5lbGVtZW50X3Byb3BlcnRpZXNbcHJvcF0gPSB0dGsuRW50cnkoY29tbW9uX2ZyYW1lKQ0KICAgICAgICAgICAgZWxpZiBmaWVsZF90eXBlID09ICdzcGluYm94JzoNCiAgICAgICAgICAgICAgICBzZWxmLmVsZW1lbnRfcHJvcGVydGllc1twcm9wXSA9IHR0ay5TcGluYm94KGNvbW1vbl9mcmFtZSwgZnJvbV89YXJnc1swXSwgdG89YXJnc1sxXSkNCiAgICAgICAgICAgIGVsaWYgZmllbGRfdHlwZSA9PSAnY29sb3InOg0KICAgICAgICAgICAgICAgIHNlbGYuZWxlbWVudF9wcm9wZXJ0aWVzW3Byb3BdID0gdHRrLkVudHJ5KGNvbW1vbl9mcmFtZSkNCiAgICAgICAgICAgICAgICB0dGsuQnV0dG9uKGNvbW1vbl9mcmFtZSwgdGV4dD0iLi4uIiwgd2lkdGg9MywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZD1sYW1iZGEgcD1wcm9wOiBzZWxmLmNob29zZV9jb2xvcihwKSkuZ3JpZChyb3c9cm93LCBjb2x1bW49MiwgcGFkeD01KQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBzZWxmLmVsZW1lbnRfcHJvcGVydGllc1twcm9wXS5ncmlkKHJvdz1yb3csIGNvbHVtbj0xLCBzdGlja3k9dGsuRVcsIHBhZHg9NSwgcGFkeT0yKQ0KICAgICAgICANCiAgICAgICAgIyBWaXNpYmlsaXR5IGNoZWNrYm94DQogICAgICAgIHNlbGYudmlzaWJsZV92YXIgPSB0ay5Cb29sZWFuVmFyKCkNCiAgICAgICAgc2VsZi5lbGVtZW50X3Byb3BlcnRpZXNbJ3Zpc2libGUnXSA9IHR0ay5DaGVja2J1dHRvbigNCiAgICAgICAgICAgIGNvbW1vbl9mcmFtZSwgdGV4dD0iVmlzaWJsZSIsIHZhcmlhYmxlPXNlbGYudmlzaWJsZV92YXIpDQogICAgICAgIHNlbGYuZWxlbWVudF9wcm9wZXJ0aWVzWyd2aXNpYmxlJ10uZ3JpZChyb3c9bGVuKHByb3BlcnRpZXMpLCBjb2x1bW49MCwgY29sdW1uc3Bhbj0yLCBzdGlja3k9dGsuVywgcGFkeD01LCBwYWR5PTIpDQogICAgDQoNCg0KICAgICAgICAjIEVsZW1lbnQtc3BlY2lmaWMgcHJvcGVydGllcyB3aWxsIGJlIGFkZGVkIGR5bmFtaWNhbGx5DQogICAgICAgIHNlbGYuZWxlbWVudF9zcGVjaWZpY19mcmFtZSA9IHR0ay5MYWJlbEZyYW1lKHBhcmVudCwgdGV4dD0iRWxlbWVudCBTcGVjaWZpYyIsIHBhZGRpbmc9NSkNCiAgICAgICAgc2VsZi5lbGVtZW50X3NwZWNpZmljX2ZyYW1lLnBhY2soZmlsbD10ay5YLCBwYWR4PTUsIHBhZHk9NSkNCg0KICAgICAgICAjIEV2ZW50cyBwYW5lbA0KICAgICAgICBzZWxmLmV2ZW50c19mcmFtZSA9IHR0ay5MYWJlbEZyYW1lKHBhcmVudCwgdGV4dD0iRXZlbnRzIiwgcGFkZGluZz01KQ0KICAgICAgICBzZWxmLmV2ZW50c19mcmFtZS5wYWNrKGZpbGw9dGsuWCwgcGFkeD01LCBwYWR5PTUpDQogICAgICAgIA0KICAgICAgICBzZWxmLmV2ZW50X2NvbWJvYm94ID0gdHRrLkNvbWJvYm94KA0KICAgICAgICAgICAgc2VsZi5ldmVudHNfZnJhbWUsIA0KICAgICAgICAgICAgdmFsdWVzPVsib25fY2xpY2siLCAib25faG92ZXIiLCAib25fa2V5X3ByZXNzIl0NCiAgICAgICAgKQ0KICAgICAgICBzZWxmLmV2ZW50X2NvbWJvYm94LnBhY2soZmlsbD10ay5YLCBwYWR4PTUsIHBhZHk9MikNCiAgICAgICAgDQogICAgICAgIHNlbGYuZXZlbnRfZnVuY3Rpb25fZW50cnkgPSB0dGsuRW50cnkoc2VsZi5ldmVudHNfZnJhbWUpDQogICAgICAgIHNlbGYuZXZlbnRfZnVuY3Rpb25fZW50cnkucGFjayhmaWxsPXRrLlgsIHBhZHg9NSwgcGFkeT0yKQ0KDQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgIyBGaXhlZDogQ2hhbmdlZCB0byB1c2UgdW5kZXJzY29yZSBwcmVmaXggZm9yIGNvbnNpc3RlbmN5DQogICAgICAgIHR0ay5CdXR0b24oDQogICAgICAgICAgICBzZWxmLmV2ZW50c19mcmFtZSwgDQogICAgICAgICAgICB0ZXh0PSJBdHRhY2ggRXZlbnQiLCANCiAgICAgICAgICAgIGNvbW1hbmQ9c2VsZi5fYXR0YWNoX2V2ZW50X3RvX2VsZW1lbnQNCiAgICAgICAgKS5wYWNrKGZpbGw9dGsuWCwgcGFkeD01LCBwYWR5PTIpDQogICAgICAgIA0KICAgICAgICB0dGsuQnV0dG9uKHBhcmVudCwgdGV4dD0iU2F2ZSBDaGFuZ2VzIiwgY29tbWFuZD1zZWxmLnNhdmVfZWxlbWVudF9wcm9wZXJ0aWVzKS5wYWNrKGZpbGw9dGsuWCwgcGFkeD01LCBwYWR5PTEwKQ0KDQogICAgZGVmIF9hdHRhY2hfZXZlbnRfdG9fZWxlbWVudChzZWxmKToNCiAgICAgICAgIiIiQXR0YWNoIGFuIGV2ZW50IGhhbmRsZXIgdG8gdGhlIHNlbGVjdGVkIGVsZW1lbnQiIiINCiAgICAgICAgaWYgbm90IHNlbGYuc2VsZWN0ZWRfZWxlbWVudDoNCiAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd3dhcm5pbmcoIldhcm5pbmciLCAiTm8gZWxlbWVudCBzZWxlY3RlZCIpDQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIA0KICAgICAgICBldmVudF90eXBlID0gc2VsZi5ldmVudF9jb21ib2JveC5nZXQoKQ0KICAgICAgICBmdW5jdGlvbl9uYW1lID0gc2VsZi5ldmVudF9mdW5jdGlvbl9lbnRyeS5nZXQoKQ0KICAgICAgICANCiAgICAgICAgaWYgbm90IGV2ZW50X3R5cGU6DQogICAgICAgICAgICBtZXNzYWdlYm94LnNob3d3YXJuaW5nKCJXYXJuaW5nIiwgIlBsZWFzZSBzZWxlY3QgYW4gZXZlbnQgdHlwZSIpDQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIA0KICAgICAgICBpZiBub3QgZnVuY3Rpb25fbmFtZToNCiAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd3dhcm5pbmcoIldhcm5pbmciLCAiUGxlYXNlIGVudGVyIGEgZnVuY3Rpb24gbmFtZSIpDQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIA0KICAgICAgICB0cnk6DQogICAgICAgICAgICAjIEluIGEgcmVhbCBpbXBsZW1lbnRhdGlvbiwgd2UnZCB2YWxpZGF0ZSB0aGUgZnVuY3Rpb24gZXhpc3RzDQogICAgICAgICAgICBzZWxmLnNlbGVjdGVkX2VsZW1lbnQuYXR0YWNoX2V2ZW50KGV2ZW50X3R5cGUsIGZ1bmN0aW9uX25hbWUpDQogICAgICAgICAgICBtZXNzYWdlYm94LnNob3dpbmZvKCJTdWNjZXNzIiwgZiJBdHRhY2hlZCB7ZnVuY3Rpb25fbmFtZX0gdG8ge2V2ZW50X3R5cGV9IikNCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93ZXJyb3IoIkVycm9yIiwgZiJGYWlsZWQgdG8gYXR0YWNoIGV2ZW50OiB7c3RyKGUpfSIpDQoNCiAgICBkZWYgY2hvb3NlX2NvbG9yKHNlbGYsIHByb3BlcnR5X25hbWUpOg0KICAgICAgICAiIiJPcGVuIGNvbG9yIGNob29zZXIgZGlhbG9nIGZvciBjb2xvciBwcm9wZXJ0aWVzIiIiDQogICAgICAgIGNvbG9yID0gY29sb3JjaG9vc2VyLmFza2NvbG9yKHRpdGxlPWYiQ2hvb3NlIHtwcm9wZXJ0eV9uYW1lLnJlcGxhY2UoJ18nLCAnICcpLnRpdGxlKCl9IikNCiAgICAgICAgaWYgY29sb3JbMV06ICAjIGhleCBjb2xvciBzZWxlY3RlZA0KICAgICAgICAgICAgc2VsZi5lbGVtZW50X3Byb3BlcnRpZXNbcHJvcGVydHlfbmFtZV0uZGVsZXRlKDAsIHRrLkVORCkNCiAgICAgICAgICAgIHNlbGYuZWxlbWVudF9wcm9wZXJ0aWVzW3Byb3BlcnR5X25hbWVdLmluc2VydCgwLCBjb2xvclsxXSkNCg0KICAgIGRlZiBzYXZlX2VsZW1lbnRfcHJvcGVydGllcyhzZWxmKToNCiAgICAgICAgIiIiU2F2ZSBjaGFuZ2VzIG1hZGUgaW4gZWxlbWVudCBwcm9wZXJ0aWVzIHBhbmVsIiIiDQogICAgICAgIGlmIG5vdCBzZWxmLnNlbGVjdGVkX2VsZW1lbnQ6DQogICAgICAgICAgICByZXR1cm4NCg0KICAgICAgICB0cnk6DQogICAgICAgICAgICAjIFVwZGF0ZSBjb21tb24gcHJvcGVydGllcw0KICAgICAgICAgICAgc2VsZi5zZWxlY3RlZF9lbGVtZW50Lm5hbWUgPSBzZWxmLmVsZW1lbnRfcHJvcGVydGllc1snbmFtZSddLmdldCgpDQogICAgICAgICAgICBzZWxmLnNlbGVjdGVkX2VsZW1lbnQueCA9IGZsb2F0KHNlbGYuZWxlbWVudF9wcm9wZXJ0aWVzWyd4J10uZ2V0KCkpDQogICAgICAgICAgICBzZWxmLnNlbGVjdGVkX2VsZW1lbnQueSA9IGZsb2F0KHNlbGYuZWxlbWVudF9wcm9wZXJ0aWVzWyd5J10uZ2V0KCkpDQogICAgICAgICAgICBzZWxmLnNlbGVjdGVkX2VsZW1lbnQud2lkdGggPSBmbG9hdChzZWxmLmVsZW1lbnRfcHJvcGVydGllc1snd2lkdGgnXS5nZXQoKSkNCiAgICAgICAgICAgIHNlbGYuc2VsZWN0ZWRfZWxlbWVudC5oZWlnaHQgPSBmbG9hdChzZWxmLmVsZW1lbnRfcHJvcGVydGllc1snaGVpZ2h0J10uZ2V0KCkpDQogICAgICAgICAgICBzZWxmLnNlbGVjdGVkX2VsZW1lbnQudmlzaWJsZSA9IHNlbGYudmlzaWJsZV92YXIuZ2V0KCkNCiAgICAgICAgICAgIHNlbGYuc2VsZWN0ZWRfZWxlbWVudC5jb3JuZXJfcmFkaXVzID0gc2VsZi5lbGVtZW50X3Byb3BlcnRpZXNbJ2Nvcm5lcl9yYWRpdXMnXS5nZXQoKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIFVwZGF0ZSBjb2xvcnMNCiAgICAgICAgICAgIGNvbG9yX3Byb3BzID0gWydiYWNrZ3JvdW5kX2NvbG9yJywgJ2JvcmRlcl9jb2xvcicsICd0ZXh0X2NvbG9yJ10NCiAgICAgICAgICAgIGZvciBwcm9wIGluIGNvbG9yX3Byb3BzOg0KICAgICAgICAgICAgICAgIGlmIHByb3AgaW4gc2VsZi5lbGVtZW50X3Byb3BlcnRpZXM6DQogICAgICAgICAgICAgICAgICAgIGNvbG9yID0gc2VsZi5lbGVtZW50X3Byb3BlcnRpZXNbcHJvcF0uZ2V0KCkNCiAgICAgICAgICAgICAgICAgICAgaWYgY29sb3Iuc3RhcnRzd2l0aCgiIyIpOg0KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZWxlY3RlZF9lbGVtZW50Ll9fc2V0YXR0cl9fKHByb3AsIGNvbG9yKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIFVwZGF0ZSBlbGVtZW50LXNwZWNpZmljIHByb3BlcnRpZXMNCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc2VsZi5zZWxlY3RlZF9lbGVtZW50LCAoQnV0dG9uLCBMYWJlbCwgVGV4dEJveCkpOg0KICAgICAgICAgICAgICAgIGlmICd0ZXh0JyBpbiBzZWxmLmVsZW1lbnRfcHJvcGVydGllczoNCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZWxlY3RlZF9lbGVtZW50LnRleHQgPSBzZWxmLmVsZW1lbnRfcHJvcGVydGllc1sndGV4dCddLmdldCgpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc2VsZi5zZWxlY3RlZF9lbGVtZW50LCAoTGFiZWwsIFRleHRCb3gpKToNCiAgICAgICAgICAgICAgICBpZiAnZm9udF9zaXplJyBpbiBzZWxmLmVsZW1lbnRfcHJvcGVydGllczoNCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZWxlY3RlZF9lbGVtZW50LmZvbnRfc2l6ZSA9IGludChzZWxmLmVsZW1lbnRfcHJvcGVydGllc1snZm9udF9zaXplJ10uZ2V0KCkpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc2VsZi5zZWxlY3RlZF9lbGVtZW50LCBUZXh0Qm94KToNCiAgICAgICAgICAgICAgICBpZiAnbXVsdGlsaW5lJyBpbiBzZWxmLmVsZW1lbnRfcHJvcGVydGllczoNCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZWxlY3RlZF9lbGVtZW50Lm11bHRpbGluZSA9IGJvb2woc2VsZi5lbGVtZW50X3Byb3BlcnRpZXNbJ211bHRpbGluZSddLmdldCgpKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlZHJhd19jYW52YXMoKQ0KICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93aW5mbygiU3VjY2VzcyIsICJQcm9wZXJ0aWVzIHNhdmVkIHN1Y2Nlc3NmdWxseSIpDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2Vycm9yKCJFcnJvciIsIGYiRmFpbGVkIHRvIHNhdmUgcHJvcGVydGllczoge3N0cihlKX0iKQ0KICAgIA0KICAgIGRlZiB1cGRhdGVfc2NlbmVfcHJvcGVydGllcyhzZWxmKToNCiAgICAgICAgIiIiVXBkYXRlIHRoZSBzY2VuZSBwcm9wZXJ0aWVzIHBhbmVsIHdpdGggY3VycmVudCBzY2VuZSBkYXRhIiIiDQogICAgICAgIHNjZW5lID0gc2VsZi5jdXJyZW50X3Byb2plY3Quc2NlbmVfbWFuYWdlci5jdXJyZW50X3NjZW5lDQogICAgICAgIGlmIG5vdCBzY2VuZToNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgDQogICAgICAgICMgVXBkYXRlIG5hbWUgZmllbGQNCiAgICAgICAgc2VsZi5zY2VuZV9wcm9wZXJ0aWVzWyduYW1lJ10uZGVsZXRlKDAsIHRrLkVORCkNCiAgICAgICAgc2VsZi5zY2VuZV9wcm9wZXJ0aWVzWyduYW1lJ10uaW5zZXJ0KDAsIHNjZW5lLm5hbWUpDQogICAgICAgIA0KICAgICAgICAjIFVwZGF0ZSBiYWNrZ3JvdW5kIGNvbG9yDQogICAgICAgIGJnX2NvbG9yID0gc2NlbmUucHJvcGVydGllcy5nZXQoJ2JhY2tncm91bmRfY29sb3InLCAoMC4yLCAwLjIsIDAuMiwgMS4wKSkNCiAgICAgICAgc2VsZi5zY2VuZV9wcm9wZXJ0aWVzWydiYWNrZ3JvdW5kX2NvbG9yJ10uZGVsZXRlKDAsIHRrLkVORCkNCiAgICAgICAgDQogICAgICAgICMgQ29udmVydCBjb2xvciB0byBoZXggaWYgaXQncyBhIHR1cGxlDQogICAgICAgIGlmIGlzaW5zdGFuY2UoYmdfY29sb3IsIHR1cGxlKToNCiAgICAgICAgICAgIGJnX2NvbG9yID0gIiMlMDJ4JTAyeCUwMngiICUgdHVwbGUoaW50KGMqMjU1KSBmb3IgYyBpbiBiZ19jb2xvcls6M10pDQogICAgICAgIHNlbGYuc2NlbmVfcHJvcGVydGllc1snYmFja2dyb3VuZF9jb2xvciddLmluc2VydCgwLCBiZ19jb2xvcikNCiAgICANCiAgICBkZWYgdXBkYXRlX2VsZW1lbnRfcHJvcGVydGllcyhzZWxmKToNCiAgICAgICAgIiIiVXBkYXRlIHRoZSBwcm9wZXJ0aWVzIHBhbmVsIHdpdGggY3VycmVudCBlbGVtZW50J3MgZGF0YSIiIg0KICAgICAgICBpZiBub3Qgc2VsZi5zZWxlY3RlZF9lbGVtZW50Og0KICAgICAgICAgICAgIyBDbGVhciBmaWVsZHMgaWYgbm8gZWxlbWVudCBzZWxlY3RlZA0KICAgICAgICAgICAgZm9yIHByb3AgaW4gWyduYW1lJywgJ3gnLCAneScsICd3aWR0aCcsICdoZWlnaHQnLCANCiAgICAgICAgICAgICAgICAgICAgICAgICdiYWNrZ3JvdW5kX2NvbG9yJywgJ2JvcmRlcl9jb2xvcicsICd0ZXh0X2NvbG9yJywNCiAgICAgICAgICAgICAgICAgICAgICAgICdjb3JuZXJfcmFkaXVzJ106DQogICAgICAgICAgICAgICAgaWYgcHJvcCBpbiBzZWxmLmVsZW1lbnRfcHJvcGVydGllczoNCiAgICAgICAgICAgICAgICAgICAgc2VsZi5lbGVtZW50X3Byb3BlcnRpZXNbcHJvcF0uZGVsZXRlKDAsIHRrLkVORCkNCiAgICAgICAgICAgIHJldHVybg0KDQogICAgICAgICMgVXBkYXRlIGNvbW1vbiBwcm9wZXJ0aWVzDQogICAgICAgIGZvciBwcm9wIGluIFsnbmFtZScsICd4JywgJ3knLCAnd2lkdGgnLCAnaGVpZ2h0JywgJ2Nvcm5lcl9yYWRpdXMnXToNCiAgICAgICAgICAgIGlmIGhhc2F0dHIoc2VsZi5zZWxlY3RlZF9lbGVtZW50LCBwcm9wKToNCiAgICAgICAgICAgICAgICBzZWxmLmVsZW1lbnRfcHJvcGVydGllc1twcm9wXS5kZWxldGUoMCwgdGsuRU5EKQ0KICAgICAgICAgICAgICAgIHNlbGYuZWxlbWVudF9wcm9wZXJ0aWVzW3Byb3BdLmluc2VydCgwLCBzdHIoZ2V0YXR0cihzZWxmLnNlbGVjdGVkX2VsZW1lbnQsIHByb3ApKSkNCg0KICAgICAgICAjIFVwZGF0ZSB2aXNpYmlsaXR5IGNoZWNrYm94DQogICAgICAgIGlmIGhhc2F0dHIoc2VsZi5zZWxlY3RlZF9lbGVtZW50LCAndmlzaWJsZScpOg0KICAgICAgICAgICAgc2VsZi5lbGVtZW50X3Byb3BlcnRpZXNbJ3Zpc2libGUnXS5zdGF0ZShbJyFhbHRlcm5hdGUnXSkNCiAgICAgICAgICAgIGlmIHNlbGYuc2VsZWN0ZWRfZWxlbWVudC52aXNpYmxlOg0KICAgICAgICAgICAgICAgIHNlbGYuZWxlbWVudF9wcm9wZXJ0aWVzWyd2aXNpYmxlJ10uc3RhdGUoWydzZWxlY3RlZCddKQ0KDQogICAgICAgICMgVXBkYXRlIGNvbG9yIHByb3BlcnRpZXMNCiAgICAgICAgZm9yIGNvbG9yX3Byb3AgaW4gWydiYWNrZ3JvdW5kX2NvbG9yJywgJ2JvcmRlcl9jb2xvcicsICd0ZXh0X2NvbG9yJ106DQogICAgICAgICAgICBpZiBoYXNhdHRyKHNlbGYuc2VsZWN0ZWRfZWxlbWVudCwgY29sb3JfcHJvcCk6DQogICAgICAgICAgICAgICAgY29sb3IgPSBnZXRhdHRyKHNlbGYuc2VsZWN0ZWRfZWxlbWVudCwgY29sb3JfcHJvcCkNCiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGNvbG9yLCB0dXBsZSk6ICAjIENvbnZlcnQgUkdCQSB0dXBsZSB0byBoZXgNCiAgICAgICAgICAgICAgICAgICAgY29sb3IgPSAiIyUwMnglMDJ4JTAyeCIgJSB0dXBsZShpbnQoYyoyNTUpIGZvciBjIGluIGNvbG9yWzozXSkNCiAgICAgICAgICAgICAgICBzZWxmLmVsZW1lbnRfcHJvcGVydGllc1tjb2xvcl9wcm9wXS5kZWxldGUoMCwgdGsuRU5EKQ0KICAgICAgICAgICAgICAgIHNlbGYuZWxlbWVudF9wcm9wZXJ0aWVzW2NvbG9yX3Byb3BdLmluc2VydCgwLCBjb2xvcikNCg0KICAgICAgICAjIFVwZGF0ZSBlbGVtZW50LXNwZWNpZmljIHByb3BlcnRpZXMNCiAgICAgICAgZm9yIHdpZGdldCBpbiBzZWxmLmVsZW1lbnRfc3BlY2lmaWNfZnJhbWUud2luZm9fY2hpbGRyZW4oKToNCiAgICAgICAgICAgIHdpZGdldC5kZXN0cm95KCkNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKHNlbGYuc2VsZWN0ZWRfZWxlbWVudCwgKEJ1dHRvbiwgTGFiZWwsIFRleHRCb3gpKToNCiAgICAgICAgICAgICMgQ3JlYXRlIGVsZW1lbnQtc3BlY2lmaWMgY29udHJvbHMgaGVyZQ0KICAgICAgICAgICAgcGFzcw0KICAgIA0KDQogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICMgU2NlbmUgYW5kIFByb2plY3QgUHJvcGVydHkgTWFuYWdlbWVudA0KICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KICAgIGRlZiBjcmVhdGVfc2NlbmVfcHJvcGVydGllc191aShzZWxmLCBwYXJlbnQpOg0KICAgICAgICAiIiJDcmVhdGUgVUkgZm9yIGVkaXRpbmcgc2NlbmUgcHJvcGVydGllcyIiIg0KICAgICAgICBzZWxmLnNjZW5lX3Byb3BlcnRpZXMgPSB7fQ0KICAgICAgICANCiAgICAgICAgdHRrLkxhYmVsKHBhcmVudCwgdGV4dD0iU2NlbmUgTmFtZToiKS5ncmlkKHJvdz0wLCBjb2x1bW49MCwgc3RpY2t5PXRrLlcsIHBhZHg9NSwgcGFkeT0yKQ0KICAgICAgICBzZWxmLnNjZW5lX3Byb3BlcnRpZXNbJ25hbWUnXSA9IHR0ay5FbnRyeShwYXJlbnQpDQogICAgICAgIHNlbGYuc2NlbmVfcHJvcGVydGllc1snbmFtZSddLmdyaWQocm93PTAsIGNvbHVtbj0xLCBzdGlja3k9dGsuRVcsIHBhZHg9NSwgcGFkeT0yKQ0KICAgICAgICANCiAgICAgICAgdHRrLkxhYmVsKHBhcmVudCwgdGV4dD0iQmFja2dyb3VuZCBDb2xvcjoiKS5ncmlkKHJvdz0xLCBjb2x1bW49MCwgc3RpY2t5PXRrLlcsIHBhZHg9NSwgcGFkeT0yKQ0KICAgICAgICBzZWxmLnNjZW5lX3Byb3BlcnRpZXNbJ2JhY2tncm91bmRfY29sb3InXSA9IHR0ay5FbnRyeShwYXJlbnQpDQogICAgICAgIHNlbGYuc2NlbmVfcHJvcGVydGllc1snYmFja2dyb3VuZF9jb2xvciddLmdyaWQocm93PTEsIGNvbHVtbj0xLCBzdGlja3k9dGsuRVcsIHBhZHg9NSwgcGFkeT0yKQ0KICAgICAgICB0dGsuQnV0dG9uKHBhcmVudCwgdGV4dD0iLi4uIiwgd2lkdGg9MywgDQogICAgICAgICAgICAgICAgICBjb21tYW5kPWxhbWJkYTogc2VsZi5jaG9vc2VfY29sb3IoJ2JhY2tncm91bmRfY29sb3InLCBzZWxmLnNjZW5lX3Byb3BlcnRpZXMpKS5ncmlkKHJvdz0xLCBjb2x1bW49MiwgcGFkeD01KQ0KICAgICAgICANCiAgICAgICAgdHRrLkJ1dHRvbihwYXJlbnQsIHRleHQ9IlNhdmUgU2NlbmUgUHJvcGVydGllcyIsIGNvbW1hbmQ9c2VsZi5zYXZlX3NjZW5lX3Byb3BlcnRpZXMpLmdyaWQoDQogICAgICAgICAgICByb3c9MiwgY29sdW1uPTAsIGNvbHVtbnNwYW49Miwgc3RpY2t5PXRrLkVXLCBwYWR4PTUsIHBhZHk9MTApDQogICAgICAgIA0KICAgICAgICBwYXJlbnQuY29sdW1uY29uZmlndXJlKDEsIHdlaWdodD0xKQ0KDQogICAgZGVmIHNhdmVfc2NlbmVfcHJvcGVydGllcyhzZWxmKToNCiAgICAgICAgIiIiU2F2ZSBjaGFuZ2VzIG1hZGUgaW4gc2NlbmUgcHJvcGVydGllcyBwYW5lbCIiIg0KICAgICAgICBzY2VuZSA9IHNlbGYuY3VycmVudF9wcm9qZWN0LnNjZW5lX21hbmFnZXIuY3VycmVudF9zY2VuZQ0KICAgICAgICBpZiBub3Qgc2NlbmU6DQogICAgICAgICAgICByZXR1cm4NCg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBuZXdfbmFtZSA9IHNlbGYuc2NlbmVfcHJvcGVydGllc1snbmFtZSddLmdldCgpDQogICAgICAgICAgICBpZiBuZXdfbmFtZSAhPSBzY2VuZS5uYW1lOg0KICAgICAgICAgICAgICAgICMgSGFuZGxlIHNjZW5lIHJlbmFtZQ0KICAgICAgICAgICAgICAgIHNjZW5lcyA9IHNlbGYuY3VycmVudF9wcm9qZWN0LnNjZW5lX21hbmFnZXIuc2NlbmVzDQogICAgICAgICAgICAgICAgc2NlbmVzW25ld19uYW1lXSA9IHNjZW5lcy5wb3Aoc2NlbmUubmFtZSkNCiAgICAgICAgICAgICAgICBzY2VuZS5uYW1lID0gbmV3X25hbWUNCiAgICAgICAgICAgICAgICBzZWxmLnJlZnJlc2hfaGllcmFyY2h5X3Zpc3VhbHMoKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIFVwZGF0ZSBiYWNrZ3JvdW5kIGNvbG9yDQogICAgICAgICAgICBiZ19jb2xvciA9IHNlbGYuc2NlbmVfcHJvcGVydGllc1snYmFja2dyb3VuZF9jb2xvciddLmdldCgpDQogICAgICAgICAgICBpZiBiZ19jb2xvcjoNCiAgICAgICAgICAgICAgICBzY2VuZS5wcm9wZXJ0aWVzWydiYWNrZ3JvdW5kX2NvbG9yJ10gPSBiZ19jb2xvcg0KICAgICAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlZHJhd19jYW52YXMoKQ0KICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93aW5mbygiU3VjY2VzcyIsICJTY2VuZSBwcm9wZXJ0aWVzIHNhdmVkIikNCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93ZXJyb3IoIkVycm9yIiwgZiJGYWlsZWQgdG8gc2F2ZSBzY2VuZSBwcm9wZXJ0aWVzOiB7c3RyKGUpfSIpDQoNCiAgICBkZWYgY3JlYXRlX3Byb2plY3Rfc2V0dGluZ3NfdWkoc2VsZiwgcGFyZW50KToNCiAgICAgICAgIiIiQ3JlYXRlIFVJIGZvciBlZGl0aW5nIHByb2plY3Qgc2V0dGluZ3MiIiINCiAgICAgICAgc2VsZi5wcm9qZWN0X3NldHRpbmdzID0ge30NCiAgICAgICAgDQogICAgICAgIHR0ay5MYWJlbChwYXJlbnQsIHRleHQ9IlByb2plY3QgTmFtZToiKS5ncmlkKHJvdz0wLCBjb2x1bW49MCwgc3RpY2t5PXRrLlcsIHBhZHg9NSwgcGFkeT0yKQ0KICAgICAgICBzZWxmLnByb2plY3Rfc2V0dGluZ3NbJ25hbWUnXSA9IHR0ay5FbnRyeShwYXJlbnQpDQogICAgICAgIHNlbGYucHJvamVjdF9zZXR0aW5nc1snbmFtZSddLmdyaWQocm93PTAsIGNvbHVtbj0xLCBzdGlja3k9dGsuRVcsIHBhZHg9NSwgcGFkeT0yKQ0KICAgICAgICANCiAgICAgICAgdHRrLkxhYmVsKHBhcmVudCwgdGV4dD0iRGVmYXVsdCBXaWR0aDoiKS5ncmlkKHJvdz0xLCBjb2x1bW49MCwgc3RpY2t5PXRrLlcsIHBhZHg9NSwgcGFkeT0yKQ0KICAgICAgICBzZWxmLnByb2plY3Rfc2V0dGluZ3NbJ2RlZmF1bHRfd2lkdGgnXSA9IHR0ay5TcGluYm94KHBhcmVudCwgZnJvbV89MTAwLCB0bz0xMDAwMCkNCiAgICAgICAgc2VsZi5wcm9qZWN0X3NldHRpbmdzWydkZWZhdWx0X3dpZHRoJ10uZ3JpZChyb3c9MSwgY29sdW1uPTEsIHN0aWNreT10ay5FVywgcGFkeD01LCBwYWR5PTIpDQogICAgICAgIA0KICAgICAgICB0dGsuTGFiZWwocGFyZW50LCB0ZXh0PSJEZWZhdWx0IEhlaWdodDoiKS5ncmlkKHJvdz0yLCBjb2x1bW49MCwgc3RpY2t5PXRrLlcsIHBhZHg9NSwgcGFkeT0yKQ0KICAgICAgICBzZWxmLnByb2plY3Rfc2V0dGluZ3NbJ2RlZmF1bHRfaGVpZ2h0J10gPSB0dGsuU3BpbmJveChwYXJlbnQsIGZyb21fPTEwMCwgdG89MTAwMDApDQogICAgICAgIHNlbGYucHJvamVjdF9zZXR0aW5nc1snZGVmYXVsdF9oZWlnaHQnXS5ncmlkKHJvdz0yLCBjb2x1bW49MSwgc3RpY2t5PXRrLkVXLCBwYWR4PTUsIHBhZHk9MikNCiAgICAgICAgDQogICAgICAgIHR0ay5MYWJlbChwYXJlbnQsIHRleHQ9IlRoZW1lOiIpLmdyaWQocm93PTMsIGNvbHVtbj0wLCBzdGlja3k9dGsuVywgcGFkeD01LCBwYWR5PTIpDQogICAgICAgIHNlbGYucHJvamVjdF9zZXR0aW5nc1sndGhlbWUnXSA9IHR0ay5Db21ib2JveChwYXJlbnQsIHZhbHVlcz1bImRhcmsiLCAibGlnaHQiXSkNCiAgICAgICAgc2VsZi5wcm9qZWN0X3NldHRpbmdzWyd0aGVtZSddLmdyaWQocm93PTMsIGNvbHVtbj0xLCBzdGlja3k9dGsuRVcsIHBhZHg9NSwgcGFkeT0yKQ0KICAgICAgIA0KICAgICAgICAjIFByb2plY3QgcGF0aHMNCiAgICAgICAgdHRrLkxhYmVsKHBhcmVudCwgdGV4dD0iUHJvamVjdCBQYXRoOiIpLmdyaWQocm93PTQsIGNvbHVtbj0wLCBzdGlja3k9dGsuVywgcGFkeD01LCBwYWR5PTIpDQogICAgICAgIHNlbGYucHJvamVjdF9zZXR0aW5nc1sncHJvamVjdF9kaXInXSA9IHR0ay5FbnRyeShwYXJlbnQsIHdpZHRoPTUwKQ0KICAgICAgICBzZWxmLnByb2plY3Rfc2V0dGluZ3NbJ3Byb2plY3RfZGlyJ10uZ3JpZChyb3c9NCwgY29sdW1uPTEsIHN0aWNreT10ay5FVywgcGFkeD01LCBwYWR5PTIpDQogICAgICAgIHNlbGYucHJvamVjdF9zZXR0aW5nc1sncHJvamVjdF9kaXInXS5pbnNlcnQoMCwgc2VsZi5jdXJyZW50X3Byb2plY3QucHJvamVjdF9kaXIgb3IgIiIpDQogICAgICAgIA0KICAgICAgICB0dGsuTGFiZWwocGFyZW50LCB0ZXh0PSJNYWluIEZpbGU6IikuZ3JpZChyb3c9NSwgY29sdW1uPTAsIHN0aWNreT10ay5XLCBwYWR4PTUsIHBhZHk9MikNCiAgICAgICAgc2VsZi5wcm9qZWN0X3NldHRpbmdzWydtYWluX2ZpbGUnXSA9IHR0ay5FbnRyeShwYXJlbnQsIHdpZHRoPTUwKQ0KICAgICAgICBzZWxmLnByb2plY3Rfc2V0dGluZ3NbJ21haW5fZmlsZSddLmdyaWQocm93PTUsIGNvbHVtbj0xLCBzdGlja3k9dGsuRVcsIHBhZHg9NSwgcGFkeT0yKQ0KICAgICAgICBzZWxmLnByb2plY3Rfc2V0dGluZ3NbJ21haW5fZmlsZSddLmluc2VydCgwLCBzZWxmLmN1cnJlbnRfcHJvamVjdC5tYWluX2ZpbGUgb3IgIiIpDQogICAgICAgIA0KICAgICAgICB0dGsuTGFiZWwocGFyZW50LCB0ZXh0PSJQeXRob24gUGF0aDoiKS5ncmlkKHJvdz02LCBjb2x1bW49MCwgc3RpY2t5PXRrLlcsIHBhZHg9NSwgcGFkeT0yKQ0KICAgICAgICBzZWxmLnByb2plY3Rfc2V0dGluZ3NbJ3B5dGhvbl9kaXInXSA9IHR0ay5FbnRyeShwYXJlbnQsIHdpZHRoPTUwKQ0KICAgICAgICBzZWxmLnByb2plY3Rfc2V0dGluZ3NbJ3B5dGhvbl9kaXInXS5ncmlkKHJvdz02LCBjb2x1bW49MSwgc3RpY2t5PXRrLkVXLCBwYWR4PTUsIHBhZHk9MikNCiAgICAgICAgc2VsZi5wcm9qZWN0X3NldHRpbmdzWydweXRob25fZGlyJ10uaW5zZXJ0KDAsIHNlbGYuY3VycmVudF9wcm9qZWN0LnB5dGhvbl9kaXIgb3IgIiIpDQoNCg0KICAgICAgICB0dGsuQnV0dG9uKHBhcmVudCwgdGV4dD0iU2F2ZSBQcm9qZWN0IFNldHRpbmdzIiwgY29tbWFuZD1zZWxmLnNhdmVfcHJvamVjdF9zZXR0aW5ncykuZ3JpZCgNCiAgICAgICAgICAgIHJvdz03LCBjb2x1bW49MCwgY29sdW1uc3Bhbj0yLCBzdGlja3k9dGsuRVcsIHBhZHg9NSwgcGFkeT0xMCkNCiAgICAgICAgDQogICAgICAgICMgUHJvamVjdCBhY3Rpb25zDQogICAgICAgIHR0ay5CdXR0b24ocGFyZW50LCB0ZXh0PSJTYXZlIFByb2plY3QiLCBjb21tYW5kPXNlbGYuc2F2ZV9wcm9qZWN0KS5ncmlkKA0KICAgICAgICAgICAgcm93PTgsIGNvbHVtbj0wLCBjb2x1bW5zcGFuPTIsIHN0aWNreT10ay5FVywgcGFkeD01LCBwYWR5PTUpDQogICAgICAgIHR0ay5CdXR0b24ocGFyZW50LCB0ZXh0PSJMb2FkIFByb2plY3QiLCBjb21tYW5kPXNlbGYubG9hZF9wcm9qZWN0KS5ncmlkKA0KICAgICAgICAgICAgcm93PTksIGNvbHVtbj0wLCBjb2x1bW5zcGFuPTIsIHN0aWNreT10ay5FVywgcGFkeD01LCBwYWR5PTUpDQogICAgICAgIHR0ay5CdXR0b24ocGFyZW50LCB0ZXh0PSJCdWlsZCBBcHBsaWNhdGlvbiIsIGNvbW1hbmQ9c2VsZi5idWlsZF9hcHBsaWNhdGlvbikuZ3JpZCgNCiAgICAgICAgICAgIHJvdz0xMCwgY29sdW1uPTAsIGNvbHVtbnNwYW49Miwgc3RpY2t5PXRrLkVXLCBwYWR4PTUsIHBhZHk9NSkNCiAgICAgICAgDQogICAgICAgIHBhcmVudC5jb2x1bW5jb25maWd1cmUoMSwgd2VpZ2h0PTEpDQoNCiAgICBkZWYgc2F2ZV9wcm9qZWN0X3NldHRpbmdzKHNlbGYpOg0KICAgICAgICAiIiJTYXZlIHByb2plY3Qgc2V0dGluZ3MgZnJvbSBwcm9wZXJ0aWVzIHBhbmVsIiIiDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHNlbGYuY3VycmVudF9wcm9qZWN0Lm5hbWUgPSBzZWxmLnByb2plY3Rfc2V0dGluZ3NbJ25hbWUnXS5nZXQoKQ0KICAgICAgICAgICAgc2VsZi5jdXJyZW50X3Byb2plY3QucHJlZmVyZW5jZXNbJ2RlZmF1bHRfd2lkdGgnXSA9IGludCgNCiAgICAgICAgICAgICAgICBzZWxmLnByb2plY3Rfc2V0dGluZ3NbJ2RlZmF1bHRfd2lkdGgnXS5nZXQoKSkNCiAgICAgICAgICAgIHNlbGYuY3VycmVudF9wcm9qZWN0LnByZWZlcmVuY2VzWydkZWZhdWx0X2hlaWdodCddID0gaW50KA0KICAgICAgICAgICAgICAgIHNlbGYucHJvamVjdF9zZXR0aW5nc1snZGVmYXVsdF9oZWlnaHQnXS5nZXQoKSkNCiAgICAgICAgICAgIHNlbGYuY3VycmVudF9wcm9qZWN0LnByZWZlcmVuY2VzWyd0aGVtZSddID0gc2VsZi5wcm9qZWN0X3NldHRpbmdzWyd0aGVtZSddLmdldCgpDQogICAgICAgICAgICANCiAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2luZm8oIlN1Y2Nlc3MiLCAiUHJvamVjdCBzZXR0aW5ncyBzYXZlZCIpDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2Vycm9yKCJFcnJvciIsIGYiRmFpbGVkIHRvIHNhdmUgcHJvamVjdCBzZXR0aW5nczoge3N0cihlKX0iKQ0KDQogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICMgUHJvamVjdCBJL08gT3BlcmF0aW9ucw0KICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KICAgIGRlZiBzYXZlX3Byb2plY3Qoc2VsZiwgZmlsZW5hbWU6IE9wdGlvbmFsW3N0cl0gPSBOb25lKToNCiAgICAgICAgIiIiU2F2ZSBjdXJyZW50IHByb2plY3QgdG8gZmlsZSIiIg0KICAgICAgICBpZiBub3QgZmlsZW5hbWU6DQogICAgICAgICAgICBmaWxlbmFtZSA9IGZpbGVkaWFsb2cuYXNrc2F2ZWFzZmlsZW5hbWUoDQogICAgICAgICAgICAgICAgZGVmYXVsdGV4dGVuc2lvbj0iLmpzb24iLA0KICAgICAgICAgICAgICAgIGZpbGV0eXBlcz1bKCJKU09OIGZpbGVzIiwgIiouanNvbiIpLCAoIkFsbCBmaWxlcyIsICIqLioiKV0NCiAgICAgICAgICAgICkNCiAgICAgICAgICAgIGlmIG5vdCBmaWxlbmFtZToNCiAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHdpdGggb3BlbihmaWxlbmFtZSwgJ3cnKSBhcyBmOg0KICAgICAgICAgICAgICAgIGpzb24uZHVtcChzZWxmLmN1cnJlbnRfcHJvamVjdC50b19kaWN0KCksIGYsIGluZGVudD0yKQ0KICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93aW5mbygiU3VjY2VzcyIsIGYiUHJvamVjdCBzYXZlZCB0byB7ZmlsZW5hbWV9IikNCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93ZXJyb3IoIkVycm9yIiwgZiJGYWlsZWQgdG8gc2F2ZSBwcm9qZWN0OiB7c3RyKGUpfSIpDQoNCiAgICBkZWYgbG9hZF9wcm9qZWN0KHNlbGYsIGZpbGVuYW1lOiBPcHRpb25hbFtzdHJdID0gTm9uZSk6DQogICAgICAgICIiIkxvYWQgcHJvamVjdCBmcm9tIGZpbGUiIiINCiAgICAgICAgaWYgbm90IGZpbGVuYW1lOg0KICAgICAgICAgICAgZmlsZW5hbWUgPSBmaWxlZGlhbG9nLmFza29wZW5maWxlbmFtZSgNCiAgICAgICAgICAgICAgICBmaWxldHlwZXM9WygiSlNPTiBmaWxlcyIsICIqLmpzb24iKSwgKCJBbGwgZmlsZXMiLCAiKi4qIildDQogICAgICAgICAgICApDQogICAgICAgICAgICBpZiBub3QgZmlsZW5hbWU6DQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIA0KICAgICAgICB0cnk6DQogICAgICAgICAgICB3aXRoIG9wZW4oZmlsZW5hbWUsICdyJykgYXMgZjoNCiAgICAgICAgICAgICAgICBkYXRhID0ganNvbi5sb2FkKGYpDQogICAgICAgICAgICBzZWxmLmN1cnJlbnRfcHJvamVjdCA9IFByb2plY3QuZnJvbV9kaWN0KGRhdGEpDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgVXBkYXRlIFVJDQogICAgICAgICAgICBzZWxmLnJlZnJlc2hfaGllcmFyY2h5X3Zpc3VhbHMoKQ0KICAgICAgICAgICAgc2VsZi51cGRhdGVfcHJvamVjdF9zZXR0aW5ncygpDQogICAgICAgICAgICBzZWxmLnJlZHJhd19jYW52YXMoKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBtZXNzYWdlYm94LnNob3dpbmZvKCJTdWNjZXNzIiwgZiJQcm9qZWN0IGxvYWRlZCBmcm9tIHtmaWxlbmFtZX0iKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICBtZXNzYWdlYm94LnNob3dlcnJvcigiRXJyb3IiLCBmIkZhaWxlZCB0byBsb2FkIHByb2plY3Q6IHtzdHIoZSl9IikNCg0KICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAjIFV0aWxpdHkgTWV0aG9kcw0KICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KICAgIGRlZiByZWZyZXNoX2hpZXJhcmNoeV92aXN1YWxzKHNlbGYpOg0KICAgICAgICAiIiJSZWZyZXNoIHRoZSBoaWVyYXJjaHkgdHJlZSB2aWV3IiIiDQogICAgICAgIHNlbGYuaGllcmFyY2h5X3RyZWUuZGVsZXRlKCpzZWxmLmhpZXJhcmNoeV90cmVlLmdldF9jaGlsZHJlbigpKQ0KICAgICAgICANCiAgICAgICAgZm9yIHNjZW5lIGluIHNlbGYuY3VycmVudF9wcm9qZWN0LnNjZW5lX21hbmFnZXIuc2NlbmVzLnZhbHVlcygpOg0KICAgICAgICAgICAgc2NlbmVfbm9kZSA9IHNlbGYuaGllcmFyY2h5X3RyZWUuaW5zZXJ0KA0KICAgICAgICAgICAgICAgICIiLCAiZW5kIiwNCiAgICAgICAgICAgICAgICB0ZXh0PXNjZW5lLm5hbWUsDQogICAgICAgICAgICAgICAgdGFncz0oZiJzY2VuZV97c2NlbmUubmFtZX0iLCksDQogICAgICAgICAgICAgICAgdmFsdWVzPSgiU2NlbmUiLCkNCiAgICAgICAgICAgICkNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBBZGQgZGlyZWN0IGVsZW1lbnRzDQogICAgICAgICAgICBmb3IgZWxlbWVudCBpbiBzY2VuZS5lbGVtZW50czoNCiAgICAgICAgICAgICAgICBzZWxmLl9hZGRfZWxlbWVudF90b190cmVlKHNjZW5lX25vZGUsIGVsZW1lbnQpDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgQWRkIHBhbmVscyBhbmQgdGhlaXIgY2hpbGRyZW4NCiAgICAgICAgICAgIGZvciBwYW5lbCBpbiBzY2VuZS5wYW5lbHM6DQogICAgICAgICAgICAgICAgcGFuZWxfbm9kZSA9IHNlbGYuX2FkZF9lbGVtZW50X3RvX3RyZWUoc2NlbmVfbm9kZSwgcGFuZWwpDQogICAgICAgICAgICAgICAgZm9yIGNoaWxkIGluIHBhbmVsLmNoaWxkcmVuOg0KICAgICAgICAgICAgICAgICAgICBzZWxmLl9hZGRfZWxlbWVudF90b190cmVlKHBhbmVsX25vZGUsIGNoaWxkKQ0KICAgICAgICANCiAgICAgICAgIyBFeHBhbmQgYWxsIG5vZGVzDQogICAgICAgIGZvciBjaGlsZCBpbiBzZWxmLmhpZXJhcmNoeV90cmVlLmdldF9jaGlsZHJlbigpOg0KICAgICAgICAgICAgc2VsZi5oaWVyYXJjaHlfdHJlZS5pdGVtKGNoaWxkLCBvcGVuPVRydWUpDQoNCiAgICBkZWYgX2FkZF9lbGVtZW50X3RvX3RyZWUoc2VsZiwgcGFyZW50LCBlbGVtZW50OiBVSUVsZW1lbnQpOg0KICAgICAgICAiIiJIZWxwZXIgdG8gYWRkIGFuIGVsZW1lbnQgdG8gaGllcmFyY2h5IHRyZWUiIiINCiAgICAgICAgaXRlbSA9IHNlbGYuaGllcmFyY2h5X3RyZWUuaW5zZXJ0KA0KICAgICAgICAgICAgcGFyZW50LCAiZW5kIiwNCiAgICAgICAgICAgIHRleHQ9ZWxlbWVudC5uYW1lLA0KICAgICAgICAgICAgdGFncz0oZiJlbGVtZW50X3tlbGVtZW50Lm5hbWV9IiwpLA0KICAgICAgICAgICAgdmFsdWVzPShlbGVtZW50Ll9fY2xhc3NfXy5fX25hbWVfXywpDQogICAgICAgICkNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2UoZWxlbWVudCwgQ29udGFpbmVyRWxlbWVudCk6DQogICAgICAgICAgICBmb3IgY2hpbGQgaW4gZWxlbWVudC5jaGlsZHJlbjoNCiAgICAgICAgICAgICAgICBzZWxmLl9hZGRfZWxlbWVudF90b190cmVlKGl0ZW0sIGNoaWxkKQ0KICAgICAgICByZXR1cm4gaXRlbQ0KDQogICAgZGVmIGdldF9lbGVtZW50X3NjZW5lKHNlbGYsIGVsZW1lbnQ6IFVJRWxlbWVudCkgLT4gT3B0aW9uYWxbU2NlbmVdOg0KICAgICAgICAiIiJGaW5kIHdoaWNoIHNjZW5lIGNvbnRhaW5zIHRoZSBnaXZlbiBlbGVtZW50IiIiDQogICAgICAgIGZvciBzY2VuZSBpbiBzZWxmLmN1cnJlbnRfcHJvamVjdC5zY2VuZV9tYW5hZ2VyLnNjZW5lcy52YWx1ZXMoKToNCiAgICAgICAgICAgIGlmIGVsZW1lbnQgaW4gc2NlbmUuZWxlbWVudHM6DQogICAgICAgICAgICAgICAgcmV0dXJuIHNjZW5lDQogICAgICAgICAgICBmb3IgcGFuZWwgaW4gc2NlbmUucGFuZWxzOg0KICAgICAgICAgICAgICAgIGlmIGVsZW1lbnQgPT0gcGFuZWwgb3IgZWxlbWVudCBpbiBwYW5lbC5jaGlsZHJlbjoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjZW5lDQogICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgZmluZF9lbGVtZW50X2J5X2lkKHNlbGYsIGVsZW1lbnRfaWQ6IHN0cikgLT4gT3B0aW9uYWxbVUlFbGVtZW50XToNCiAgICAgICAgIiIiRmluZCBlbGVtZW50IGJ5IGl0cyBJRCBpbiBjdXJyZW50IHNjZW5lIiIiDQogICAgICAgIHNjZW5lID0gc2VsZi5jdXJyZW50X3Byb2plY3Quc2NlbmVfbWFuYWdlci5jdXJyZW50X3NjZW5lDQogICAgICAgIGlmIG5vdCBzY2VuZToNCiAgICAgICAgICAgIHJldHVybiBOb25lDQogICAgICAgICAgICANCiAgICAgICAgIyBDaGVjayByb290IGVsZW1lbnRzDQogICAgICAgIGZvciBlbGVtZW50IGluIHNjZW5lLmVsZW1lbnRzOg0KICAgICAgICAgICAgaWYgZWxlbWVudC5uYW1lID09IGVsZW1lbnRfaWQ6DQogICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQNCiAgICAgICAgICAgICAgICANCiAgICAgICAgIyBDaGVjayBwYW5lbHMgYW5kIHRoZWlyIGNoaWxkcmVuDQogICAgICAgIGZvciBwYW5lbCBpbiBzY2VuZS5wYW5lbHM6DQogICAgICAgICAgICBpZiBwYW5lbC5uYW1lID09IGVsZW1lbnRfaWQ6DQogICAgICAgICAgICAgICAgcmV0dXJuIHBhbmVsDQogICAgICAgICAgICBmb3IgY2hpbGQgaW4gcGFuZWwuY2hpbGRyZW46DQogICAgICAgICAgICAgICAgaWYgY2hpbGQubmFtZSA9PSBlbGVtZW50X2lkOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGQNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAjIERyYXdpbmcgTWV0aG9kcw0KICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KICAgIGRlZiByZWRyYXdfY2FudmFzKHNlbGYpOg0KICAgICAgICAiIiJSZWRyYXcgYWxsIFVJIGVsZW1lbnRzIG9uIGNhbnZhcyIiIg0KICAgICAgICBzZWxmLmNhbnZhcy5kZWxldGUoImFsbCIpDQogICAgICAgIHNjZW5lID0gc2VsZi5jdXJyZW50X3Byb2plY3Quc2NlbmVfbWFuYWdlci5jdXJyZW50X3NjZW5lDQogICAgICAgIGlmIG5vdCBzY2VuZToNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgDQogICAgICAgICMgRHJhdyBzY2VuZSBiYWNrZ3JvdW5kDQogICAgICAgIGJnX2NvbG9yID0gc2NlbmUucHJvcGVydGllcy5nZXQoJ2JhY2tncm91bmRfY29sb3InLCAiIzMzMzMzMyIpDQogICAgICAgIGlmIGlzaW5zdGFuY2UoYmdfY29sb3IsIHR1cGxlKToNCiAgICAgICAgICAgIGJnX2NvbG9yID0gIiMlMDJ4JTAyeCUwMngiICUgdHVwbGUoaW50KGMqMjU1KSBmb3IgYyBpbiBiZ19jb2xvcls6M10pDQogICAgICAgIHNlbGYuY2FudmFzLmNvbmZpZyhiZz1iZ19jb2xvcikNCiAgICAgICAgDQogICAgICAgICMgRHJhdyBhbGwgZWxlbWVudHMNCiAgICAgICAgZm9yIGVsZW1lbnQgaW4gc2NlbmUuZWxlbWVudHMgKyBzY2VuZS5wYW5lbHM6DQogICAgICAgICAgICBzZWxmLl9kcmF3X2VsZW1lbnRfcmVjdXJzaXZlKGVsZW1lbnQpDQoNCiAgICBkZWYgX2RyYXdfZWxlbWVudF9yZWN1cnNpdmUoc2VsZiwgZWxlbWVudDogVUlFbGVtZW50KToNCiAgICAgICAgIiIiUmVjdXJzaXZlbHkgZHJhdyBhbiBlbGVtZW50IGFuZCBpdHMgY2hpbGRyZW4iIiINCiAgICAgICAgaWYgbm90IGVsZW1lbnQudmlzaWJsZToNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgDQogICAgICAgIHgsIHkgPSBlbGVtZW50LmdldF9hYnNvbHV0ZV9wb3NpdGlvbigpDQogICAgICAgIA0KICAgICAgICAjIERyYXcgZWxlbWVudCBiYXNlZCBvbiB0eXBlDQogICAgICAgIGlmIGlzaW5zdGFuY2UoZWxlbWVudCwgKFBhbmVsLCBCdXR0b24sIFRleHRCb3gpKToNCiAgICAgICAgICAgIGJnX2NvbG9yID0gZWxlbWVudC5iYWNrZ3JvdW5kX2NvbG9yDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGJnX2NvbG9yLCB0dXBsZSk6DQogICAgICAgICAgICAgICAgYmdfY29sb3IgPSAiIyUwMnglMDJ4JTAyeCIgJSB0dXBsZShpbnQoYyoyNTUpIGZvciBjIGluIGJnX2NvbG9yWzozXSkNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIHNlbGYuY2FudmFzLmNyZWF0ZV9yZWN0YW5nbGUoDQogICAgICAgICAgICAgICAgeCwgeSwgeCArIGVsZW1lbnQud2lkdGgsIHkgKyBlbGVtZW50LmhlaWdodCwNCiAgICAgICAgICAgICAgICBmaWxsPWJnX2NvbG9yLA0KICAgICAgICAgICAgICAgIG91dGxpbmU9ZWxlbWVudC5ib3JkZXJfY29sb3INCiAgICAgICAgICAgICkNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2UoZWxlbWVudCwgKEJ1dHRvbiwgTGFiZWwsIFRleHRCb3gpKToNCiAgICAgICAgICAgIHRleHRfY29sb3IgPSBlbGVtZW50LnRleHRfY29sb3INCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UodGV4dF9jb2xvciwgdHVwbGUpOg0KICAgICAgICAgICAgICAgIHRleHRfY29sb3IgPSAiIyUwMnglMDJ4JTAyeCIgJSB0dXBsZShpbnQoYyoyNTUpIGZvciBjIGluIHRleHRfY29sb3JbOjNdKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgdGV4dCA9IGdldGF0dHIoZWxlbWVudCwgJ3RleHQnLCAnJykNCiAgICAgICAgICAgIGlmIHRleHQ6DQogICAgICAgICAgICAgICAgc2VsZi5jYW52YXMuY3JlYXRlX3RleHQoDQogICAgICAgICAgICAgICAgICAgIHggKyBlbGVtZW50LndpZHRoLzIsIHkgKyBlbGVtZW50LmhlaWdodC8yLA0KICAgICAgICAgICAgICAgICAgICB0ZXh0PXRleHQsDQogICAgICAgICAgICAgICAgICAgIGZpbGw9dGV4dF9jb2xvciwNCiAgICAgICAgICAgICAgICAgICAgYW5jaG9yPXRrLkNFTlRFUg0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgDQogICAgICAgICMgRHJhdyBjaGlsZHJlbg0KICAgICAgICBmb3IgY2hpbGQgaW4gZWxlbWVudC5jaGlsZHJlbjoNCiAgICAgICAgICAgIHNlbGYuX2RyYXdfZWxlbWVudF9yZWN1cnNpdmUoY2hpbGQpDQoNCiAgICBkZWYgYnVpbGRfYXBwbGljYXRpb24oc2VsZik6DQogICAgICAgICIiIkdlbmVyYXRlIGV4ZWN1dGFibGUgUHl0aG9uIGNvZGUiIiINCiAgICAgICAgZmlsZW5hbWUgPSBmaWxlZGlhbG9nLmFza3NhdmVhc2ZpbGVuYW1lKA0KICAgICAgICAgICAgZGVmYXVsdGV4dGVuc2lvbj0iLnB5IiwNCiAgICAgICAgICAgIGZpbGV0eXBlcz1bKCJQeXRob24gZmlsZXMiLCAiKi5weSIpLCAoIkFsbCBmaWxlcyIsICIqLioiKV0sDQogICAgICAgICAgICBpbml0aWFsZmlsZT1mIntzZWxmLmN1cnJlbnRfcHJvamVjdC5uYW1lLmxvd2VyKCkucmVwbGFjZSgnICcsICdfJyl9X3VpLnB5Ig0KICAgICAgICApDQogICAgICAgIGlmIG5vdCBmaWxlbmFtZToNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGNvZGUgPSBzZWxmLmdlbmVyYXRlX3B5dGhvbl9jb2RlKCkNCiAgICAgICAgICAgIHdpdGggb3BlbihmaWxlbmFtZSwgJ3cnKSBhcyBmOg0KICAgICAgICAgICAgICAgIGYud3JpdGUoY29kZSkNCiAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2luZm8oIlN1Y2Nlc3MiLCBmIkFwcGxpY2F0aW9uIGJ1aWx0IHRvIHtmaWxlbmFtZX0iKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICBtZXNzYWdlYm94LnNob3dlcnJvcigiRXJyb3IiLCBmIkZhaWxlZCB0byBidWlsZCBhcHBsaWNhdGlvbjoge3N0cihlKX0iKQ0KDQogICAgZGVmIGdlbmVyYXRlX3B5dGhvbl9jb2RlKHNlbGYpIC0+IHN0cjoNCiAgICAgICAgIiIiR2VuZXJhdGUgUHl0aG9uIGNvZGUgZm9yIHRoZSBjdXJyZW50IFVJIiIiDQogICAgICAgICMgW0ltcGxlbWVudGF0aW9uIG9mIGNvZGUgZ2VuZXJhdGlvbiB3b3VsZCBnbyBoZXJlXQ0KICAgICAgICAjIFRoaXMgd291bGQgYmUgc2ltaWxhciB0byB0aGUgb3JpZ2luYWwgbWV0aG9kDQogICAgICAgIHJldHVybiAiIyBHZW5lcmF0ZWQgVUkgY29kZSB3b3VsZCBnbyBoZXJlIg0KDQojIE1haW4gQXBwbGljYXRpb24NCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6DQogICAgcm9vdCA9IHRrLlRrKCkNCiAgICBlZGl0b3IgPSBVSUVkaXRvcihyb290KQ0KICAgIHJvb3QubWFpbmxvb3AoKQ0K"}}}